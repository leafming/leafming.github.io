
<!doctype html>














<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Flink," />





  <link rel="alternate" href="/atom.xml" title="iLeaf" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="本文主要关于针对Flink官网分布式运行时部分的知识梳理脑图。">
<meta name="keywords" content="Flink">
<meta property="og:type" content="article">
<meta property="og:title" content="Flink分布式运行时知识梳理脑图">
<meta property="og:url" content="http://localhost:4000/bigdata/2019/02/17/Flink%E8%BF%90%E8%A1%8C%E6%97%B6%E8%84%91%E5%9B%BE%E6%A2%B3%E7%90%86/">
<meta property="og:site_name" content="iLeaf">
<meta property="og:description" content="本文主要关于针对Flink官网分布式运行时部分的知识梳理脑图。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-02-17T00:00:00+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flink分布式运行时知识梳理脑图">
<meta name="twitter:description" content="本文主要关于针对Flink官网分布式运行时部分的知识梳理脑图。">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>Flink分布式运行时知识梳理脑图 | iLeaf</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d509d2d894059ebd8e784708e52dcdc7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">iLeaf</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Leaf's Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/bigdata/2019/02/17/Flink%E8%BF%90%E8%A1%8C%E6%97%B6%E8%84%91%E5%9B%BE%E6%A2%B3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="叶子  ( ˘ ³˘)♥">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/IMG_8739.GIF">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iLeaf">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            Flink分布式运行时知识梳理脑图
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-17T00:00:00+08:00">
                2019-02-17
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2019-02-17">
                2019-02-17
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/BigData" itemprop="url" rel="index">
                    <span itemprop="name">BigData</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/bigdata/2019/02/17/Flink%E8%BF%90%E8%A1%8C%E6%97%B6%E8%84%91%E5%9B%BE%E6%A2%B3%E7%90%86/" class="leancloud_visitors" data-flag-title="Flink分布式运行时知识梳理脑图">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          
            
                <div class="post-description">
                    本文主要关于针对Flink官网分布式运行时部分的知识梳理脑图。
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
  <p>最近在重新整理学习flink官网内容，并在学习过程中将内容总结成脑图，是叶子自己最近一点一点整理绘制哒，转载请贴此文链接谢谢啦～图片以
svg形式插入文章，可拖动显示完整，后续如有更改会持续更新。</p>
</blockquote>

<p>此脑图绘制依据官网链接：<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.7/concepts/runtime.html">Distributed Runtime Environment</a></p>

<div width="100%" style="overflow-x: auto;">
<svg id="kity_svg_6" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2303" height="7719" style="background-color: rgb(251, 251, 251); visibility: visible; background-position: initial initial; background-repeat: initial initial;" viewBox="0 0 2303 7719"><defs id="kity_defs_7"><linearGradient id="kity_linearGradient_17" x1="0" y1="0" x2="0" y2="1"><stop id="kity_stop_18" offset="0" stop-color="rgb(255, 255, 255)"></stop><stop id="kity_stop_19" offset="1" stop-color="rgb(204, 204, 204)"></stop></linearGradient><marker id="kity_marker_2" orient="auto" refX="6" refY="0" viewBox="-7 -7 14 14" markerWidth="7" markerHeight="7" markerUnits="userSpaceOnUse"><path id="kity_path_3" fill="rgb(115, 161, 191)" stroke="none" d="M6,0A6,6,0,1,1,-6,0A6,6,0,1,1,6,0"></path></marker></defs><g id="kity_g_8"><g id="minder1" text-rendering="optimize-speed"><g id="minder_connect_group1"><path id="kity_path_31" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M119.5,4032.5A217,3420.5,0,0,1,336.5,612"></path><path id="kity_path_33" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M548.5,612.5C568.5,612,568.5,128.5,588.5,128.5"></path><path id="kity_path_35" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M636.5,128.5C656.5,128.5,656.5,103,676.5,103"></path><path id="kity_path_37" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M636.5,128.5C656.5,128.5,656.5,226.5,676.5,226.5"></path><path id="kity_path_39" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M548.5,612.5C568.5,612,568.5,303.5,588.5,303.5"></path><path id="kity_path_41" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M655.5,303.5C675.5,303.5,675.5,277.5,695.5,277.5"></path><path id="kity_path_43" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M655.5,303.5C675.5,303.5,675.5,329.5,695.5,329.5"></path><path id="kity_path_45" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M548.5,612.5C568.5,612,568.5,1095.5,588.5,1095.5"></path><path id="kity_path_47" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M700.5,1095.5C720.5,1095.5,720.5,538.5,740.5,538.5"></path><path id="kity_path_49" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,538.5C804.5,538.5,804.5,381.5,824.5,381.5"></path><path id="kity_path_51" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,538.5C804.5,538.5,804.5,433.5,824.5,433.5"></path><path id="kity_path_53" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,538.5C804.5,538.5,804.5,564.5,824.5,564.5"></path><path id="kity_path_55" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M993.5,564.5C1013.5,564.5,1013.5,564.5,1033.5,564.5"></path><path id="kity_path_57" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,538.5C804.5,538.5,804.5,695.5,824.5,695.5"></path><path id="kity_path_59" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M700.5,1095.5C720.5,1095.5,720.5,826.5,740.5,826.5"></path><path id="kity_path_61" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,826.5C804.5,826.5,804.5,747.5,824.5,747.5"></path><path id="kity_path_63" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,826.5C804.5,826.5,804.5,799.5,824.5,799.5"></path><path id="kity_path_65" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M784.5,826.5C804.5,826.5,804.5,878.5,824.5,878.5"></path><path id="kity_path_67" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1018.5,878.5C1038.5,878.5,1038.5,852.5,1058.5,852.5"></path><path id="kity_path_69" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1431.5,852.5C1451.5,852.5,1451.5,852.5,1471.5,852.5"></path><path id="kity_path_71" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1018.5,878.5C1038.5,878.5,1038.5,904.5,1058.5,904.5"></path><path id="kity_path_73" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1376.5,904.5C1396.5,904.5,1396.5,904.5,1416.5,904.5"></path><path id="kity_path_75" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M700.5,1095.5C720.5,1095.5,720.5,1243.5,740.5,1243.5"></path><path id="kity_path_77" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M912.5,1243.5C932.5,1243.5,932.5,1078.5,952.5,1078.5"></path><path id="kity_path_79" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1112.5,1078.5C1132.5,1078.5,1132.5,1079,1152.5,1079"></path><path id="kity_path_81" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M912.5,1243.5C932.5,1243.5,932.5,1408.5,952.5,1408.5"></path><path id="kity_path_83" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1252.5,1336.5,1252.5"></path><path id="kity_path_85" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1304.5,1336.5,1304.5"></path><path id="kity_path_87" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1356.5,1336.5,1356.5"></path><path id="kity_path_89" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1408.5,1336.5,1408.5"></path><path id="kity_path_91" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1460.5,1336.5,1460.5"></path><path id="kity_path_93" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1512.5,1336.5,1512.5"></path><path id="kity_path_95" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1296.5,1408.5C1316.5,1408.5,1316.5,1564.5,1336.5,1564.5"></path><path id="kity_path_97" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M700.5,1095.5C720.5,1095.5,720.5,1634.5,740.5,1634.5"></path><path id="kity_path_99" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M119.5,4032.5A217,1776,0,0,1,336.5,2256.5"></path><path id="kity_path_101" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M635.5,2256.5C655.5,2256.5,655.5,1792.5,675.5,1792.5"></path><path id="kity_path_103" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M855.5,1792.5C875.5,1792.5,875.5,1740.5,895.5,1740.5"></path><path id="kity_path_105" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M939.5,1740.5C959.5,1740.5,959.5,1714.5,979.5,1714.5"></path><path id="kity_path_107" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M939.5,1740.5C959.5,1740.5,959.5,1766.5,979.5,1766.5"></path><path id="kity_path_109" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M855.5,1792.5C875.5,1792.5,875.5,1844.5,895.5,1844.5"></path><path id="kity_path_111" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M939.5,1844.5C959.5,1844.5,959.5,1818.5,979.5,1818.5"></path><path id="kity_path_113" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M939.5,1844.5C959.5,1844.5,959.5,1870.5,979.5,1870.5"></path><path id="kity_path_115" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M635.5,2256.5C655.5,2256.5,655.5,2040.5,675.5,2040.5"></path><path id="kity_path_117" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M854.5,2040.5C874.5,2040.5,874.5,1984.5,894.5,1984.5"></path><path id="kity_path_119" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M938.5,1984.5C958.5,1984.5,958.5,1923.5,978.5,1923.5"></path><path id="kity_path_121" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M938.5,1984.5C958.5,1984.5,958.5,1984.5,978.5,1984.5"></path><path id="kity_path_123" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M938.5,1984.5C958.5,1984.5,958.5,2045.5,978.5,2045.5"></path><path id="kity_path_125" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M854.5,2040.5C874.5,2040.5,874.5,2097.5,894.5,2097.5"></path><path id="kity_path_127" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M938.5,2097.5C958.5,2097.5,958.5,2097.5,978.5,2097.5"></path><path id="kity_path_129" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M635.5,2256.5C655.5,2256.5,655.5,2200.5,675.5,2200.5"></path><path id="kity_path_131" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M743.5,2200.5C763.5,2200.5,763.5,2200.5,783.5,2200.5"></path><path id="kity_path_133" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M851.5,2200.5C871.5,2200.5,871.5,2148.5,891.5,2148.5"></path><path id="kity_path_135" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M851.5,2200.5C871.5,2200.5,871.5,2200.5,891.5,2200.5"></path><path id="kity_path_137" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M851.5,2200.5C871.5,2200.5,871.5,2252.5,891.5,2252.5"></path><path id="kity_path_139" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M635.5,2256.5C655.5,2256.5,655.5,2356.5,675.5,2356.5"></path><path id="kity_path_141" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M812.5,2356.5C832.5,2356.5,832.5,2304.5,852.5,2304.5"></path><path id="kity_path_143" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M812.5,2356.5C832.5,2356.5,832.5,2356.5,852.5,2356.5"></path><path id="kity_path_145" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M812.5,2356.5C832.5,2356.5,832.5,2408.5,852.5,2408.5"></path><path id="kity_path_147" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M635.5,2256.5C655.5,2256.5,655.5,2738.5,675.5,2738.5"></path><path id="kity_path_149" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M755.5,2738.5C775.5,2738.5,775.5,2527,795.5,2527"></path><path id="kity_path_151" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M755.5,2738.5C775.5,2738.5,775.5,2644.5,795.5,2644.5"></path><path id="kity_path_153" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M755.5,2738.5C775.5,2738.5,775.5,2812.5,795.5,2812.5"></path><path id="kity_path_155" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M863.5,2812.5C883.5,2812.5,883.5,2700.5,903.5,2700.5"></path><path id="kity_path_157" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M863.5,2812.5C883.5,2812.5,883.5,2760.5,903.5,2760.5"></path><path id="kity_path_159" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M863.5,2812.5C883.5,2812.5,883.5,2820.5,903.5,2820.5"></path><path id="kity_path_161" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M863.5,2812.5C883.5,2812.5,883.5,2876.5,903.5,2876.5"></path><path id="kity_path_163" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M863.5,2812.5C883.5,2812.5,883.5,2928.5,903.5,2928.5"></path><path id="kity_path_165" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M755.5,2738.5C775.5,2738.5,775.5,2998.5,795.5,2998.5"></path><path id="kity_path_167" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1293.5,2998.5C1313.5,2998.5,1313.5,2998.5,1333.5,2998.5"></path><path id="kity_path_169" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M119.5,4032.5A217,206,0,0,0,336.5,4238.5"></path><path id="kity_path_171" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M542.5,4238.5C562.5,4238.5,562.5,3310.5,582.5,3310.5"></path><path id="kity_path_173" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M749.5,3310.5C769.5,3310.5,769.5,3078.5,789.5,3078.5"></path><path id="kity_path_175" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3078.5C877.5,3078.5,877.5,3078.5,897.5,3078.5"></path><path id="kity_path_177" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M749.5,3310.5C769.5,3310.5,769.5,3130.5,789.5,3130.5"></path><path id="kity_path_179" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M981.5,3130.5C1001.5,3130.5,1001.5,3130.5,1021.5,3130.5"></path><path id="kity_path_181" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M749.5,3310.5C769.5,3310.5,769.5,3234.5,789.5,3234.5"></path><path id="kity_path_183" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3234.5C877.5,3234.5,877.5,3182.5,897.5,3182.5"></path><path id="kity_path_185" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3234.5C877.5,3234.5,877.5,3234.5,897.5,3234.5"></path><path id="kity_path_187" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3234.5C877.5,3234.5,877.5,3286.5,897.5,3286.5"></path><path id="kity_path_189" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1001.5,3286.5C1021.5,3286.5,1021.5,3286.5,1041.5,3286.5"></path><path id="kity_path_191" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M749.5,3310.5C769.5,3310.5,769.5,3543.5,789.5,3543.5"></path><path id="kity_path_193" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3543.5C877.5,3543.5,877.5,3338.5,897.5,3338.5"></path><path id="kity_path_195" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3543.5C877.5,3543.5,877.5,3480.5,897.5,3480.5"></path><path id="kity_path_197" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,3480.5C985.5,3480.5,985.5,3391.5,1005.5,3391.5"></path><path id="kity_path_199" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1085.5,3391.5C1105.5,3391.5,1105.5,3391.5,1125.5,3391.5"></path><path id="kity_path_201" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,3480.5C985.5,3480.5,985.5,3570.5,1005.5,3570.5"></path><path id="kity_path_203" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1061.5,3570.5C1081.5,3570.5,1081.5,3443.5,1101.5,3443.5"></path><path id="kity_path_205" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1061.5,3570.5C1081.5,3570.5,1081.5,3530.5,1101.5,3530.5"></path><path id="kity_path_207" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1145.5,3530.5C1165.5,3530.5,1165.5,3504.5,1185.5,3504.5"></path><path id="kity_path_209" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1145.5,3530.5C1165.5,3530.5,1165.5,3565.5,1185.5,3565.5"></path><path id="kity_path_211" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1061.5,3570.5C1081.5,3570.5,1081.5,3657.5,1101.5,3657.5"></path><path id="kity_path_213" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M857.5,3543.5C877.5,3543.5,877.5,3748.5,897.5,3748.5"></path><path id="kity_path_215" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M542.5,4238.5C562.5,4238.5,562.5,4258.5,582.5,4258.5"></path><path id="kity_path_217" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,4258.5C689.5,4258.5,689.5,3834.5,709.5,3834.5"></path><path id="kity_path_219" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M808.5,3834.5C828.5,3834.5,828.5,3808.5,848.5,3808.5"></path><path id="kity_path_221" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M808.5,3834.5C828.5,3834.5,828.5,3869.5,848.5,3869.5"></path><path id="kity_path_223" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,4258.5C689.5,4258.5,689.5,4137.5,709.5,4137.5"></path><path id="kity_path_225" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M832.5,4137.5C852.5,4137.5,852.5,3931.5,872.5,3931.5"></path><path id="kity_path_227" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M832.5,4137.5C852.5,4137.5,852.5,4097.5,872.5,4097.5"></path><path id="kity_path_229" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1163.5,4097.5C1183.5,4097.5,1183.5,3992.5,1203.5,3992.5"></path><path id="kity_path_231" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1163.5,4097.5C1183.5,4097.5,1183.5,4044.5,1203.5,4044.5"></path><path id="kity_path_233" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1163.5,4097.5C1183.5,4097.5,1183.5,4105.5,1203.5,4105.5"></path><path id="kity_path_235" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1163.5,4097.5C1183.5,4097.5,1183.5,4184.5,1203.5,4184.5"></path><path id="kity_path_237" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M832.5,4137.5C852.5,4137.5,852.5,4304,872.5,4304"></path><path id="kity_path_239" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1179.5,4304.5C1199.5,4304,1199.5,4265.5,1219.5,4265.5"></path><path id="kity_path_241" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1179.5,4304.5C1199.5,4304,1199.5,4352.5,1219.5,4352.5"></path><path id="kity_path_243" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1287.5,4352.5C1307.5,4352.5,1307.5,4326.5,1327.5,4326.5"></path><path id="kity_path_245" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1287.5,4352.5C1307.5,4352.5,1307.5,4378.5,1327.5,4378.5"></path><path id="kity_path_247" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,4258.5C689.5,4258.5,689.5,4682.5,709.5,4682.5"></path><path id="kity_path_249" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M868.5,4682.5C888.5,4682.5,888.5,4572.5,908.5,4572.5"></path><path id="kity_path_251" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1029.5,4572.5C1049.5,4572.5,1049.5,4481.5,1069.5,4481.5"></path><path id="kity_path_253" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1113.5,4481.5C1133.5,4481.5,1133.5,4429.5,1153.5,4429.5"></path><path id="kity_path_255" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1113.5,4481.5C1133.5,4481.5,1133.5,4481.5,1153.5,4481.5"></path><path id="kity_path_257" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1113.5,4481.5C1133.5,4481.5,1133.5,4533.5,1153.5,4533.5"></path><path id="kity_path_259" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1029.5,4572.5C1049.5,4572.5,1049.5,4663.5,1069.5,4663.5"></path><path id="kity_path_261" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1298.5,4663.5C1318.5,4663.5,1318.5,4585.5,1338.5,4585.5"></path><path id="kity_path_263" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1298.5,4663.5C1318.5,4663.5,1318.5,4663.5,1338.5,4663.5"></path><path id="kity_path_265" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1625.5,4663.5C1645.5,4663.5,1645.5,4637.5,1665.5,4637.5"></path><path id="kity_path_267" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1625.5,4663.5C1645.5,4663.5,1645.5,4689.5,1665.5,4689.5"></path><path id="kity_path_269" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1298.5,4663.5C1318.5,4663.5,1318.5,4741.5,1338.5,4741.5"></path><path id="kity_path_271" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M868.5,4682.5C888.5,4682.5,888.5,4793.5,908.5,4793.5"></path><path id="kity_path_273" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1034.5,4793.5C1054.5,4793.5,1054.5,4793.5,1074.5,4793.5"></path><path id="kity_path_275" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M542.5,4238.5C562.5,4238.5,562.5,4886.5,582.5,4886.5"></path><path id="kity_path_277" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M741.5,4886.5C761.5,4886.5,761.5,4845.5,781.5,4845.5"></path><path id="kity_path_279" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M741.5,4886.5C761.5,4886.5,761.5,4927.5,781.5,4927.5"></path><path id="kity_path_281" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1170.5,4927.5C1190.5,4927.5,1190.5,4928,1210.5,4928"></path><path id="kity_path_283" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M542.5,4238.5C562.5,4238.5,562.5,5157.5,582.5,5157.5"></path><path id="kity_path_285" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M705.5,5157.5C725.5,5157.5,725.5,5010.5,745.5,5010.5"></path><path id="kity_path_287" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1815.5,5010.5C1835.5,5010.5,1835.5,5010.5,1855.5,5010.5"></path><path id="kity_path_289" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M705.5,5157.5C725.5,5157.5,725.5,5088.5,745.5,5088.5"></path><path id="kity_path_291" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M945.5,5088.5C965.5,5088.5,965.5,5062.5,985.5,5062.5"></path><path id="kity_path_293" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M945.5,5088.5C965.5,5088.5,965.5,5114.5,985.5,5114.5"></path><path id="kity_path_295" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M705.5,5157.5C725.5,5157.5,725.5,5244.5,745.5,5244.5"></path><path id="kity_path_297" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,5244.5C985.5,5244.5,985.5,5166.5,1005.5,5166.5"></path><path id="kity_path_299" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,5244.5C985.5,5244.5,985.5,5218.5,1005.5,5218.5"></path><path id="kity_path_301" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,5244.5C985.5,5244.5,985.5,5270.5,1005.5,5270.5"></path><path id="kity_path_303" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M965.5,5244.5C985.5,5244.5,985.5,5322.5,1005.5,5322.5"></path><path id="kity_path_305" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M119.5,4032.5A217,2292,0,0,0,336.5,6324.5"></path><path id="kity_path_307" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M483.5,6324.5C503.5,6324.5,503.5,5462.5,523.5,5462.5"></path><path id="kity_path_309" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,5462.5C587.5,5462.5,587.5,5384.5,607.5,5384.5"></path><path id="kity_path_311" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,5462.5C587.5,5462.5,587.5,5436.5,607.5,5436.5"></path><path id="kity_path_313" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,5462.5C587.5,5462.5,587.5,5488.5,607.5,5488.5"></path><path id="kity_path_315" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,5462.5C587.5,5462.5,587.5,5540.5,607.5,5540.5"></path><path id="kity_path_317" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M483.5,6324.5C503.5,6324.5,503.5,6311.5,523.5,6311.5"></path><path id="kity_path_319" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M723.5,6311.5C743.5,6311.5,743.5,5849.5,763.5,5849.5"></path><path id="kity_path_321" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M961.5,5849.5C981.5,5849.5,981.5,5680.5,1001.5,5680.5"></path><path id="kity_path_323" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1045.5,5680.5C1065.5,5680.5,1065.5,5593.5,1085.5,5593.5"></path><path id="kity_path_325" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1045.5,5680.5C1065.5,5680.5,1065.5,5645.5,1085.5,5645.5"></path><path id="kity_path_327" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1045.5,5680.5C1065.5,5680.5,1065.5,5697.5,1085.5,5697.5"></path><path id="kity_path_329" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1045.5,5680.5C1065.5,5680.5,1065.5,5758.5,1085.5,5758.5"></path><path id="kity_path_331" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M961.5,5849.5C981.5,5849.5,981.5,5880.5,1001.5,5880.5"></path><path id="kity_path_333" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1057.5,5880.5C1077.5,5880.5,1077.5,5828.5,1097.5,5828.5"></path><path id="kity_path_335" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1057.5,5880.5C1077.5,5880.5,1077.5,5889.5,1097.5,5889.5"></path><path id="kity_path_337" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1057.5,5880.5C1077.5,5880.5,1077.5,5941.5,1097.5,5941.5"></path><path id="kity_path_339" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M961.5,5849.5C981.5,5849.5,981.5,6019.5,1001.5,6019.5"></path><path id="kity_path_341" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1069.5,6019.5C1089.5,6019.5,1089.5,5993.5,1109.5,5993.5"></path><path id="kity_path_343" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1069.5,6019.5C1089.5,6019.5,1089.5,6045.5,1109.5,6045.5"></path><path id="kity_path_345" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M723.5,6311.5C743.5,6311.5,743.5,6291.5,763.5,6291.5"></path><path id="kity_path_347" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M876.5,6291.5C896.5,6291.5,896.5,6200.5,916.5,6200.5"></path><path id="kity_path_349" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M960.5,6200.5C980.5,6200.5,980.5,6096.5,1000.5,6096.5"></path><path id="kity_path_351" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M960.5,6200.5C980.5,6200.5,980.5,6148.5,1000.5,6148.5"></path><path id="kity_path_353" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M960.5,6200.5C980.5,6200.5,980.5,6200.5,1000.5,6200.5"></path><path id="kity_path_355" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M960.5,6200.5C980.5,6200.5,980.5,6252.5,1000.5,6252.5"></path><path id="kity_path_357" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M960.5,6200.5C980.5,6200.5,980.5,6304.5,1000.5,6304.5"></path><path id="kity_path_359" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M876.5,6291.5C896.5,6291.5,896.5,6382.5,916.5,6382.5"></path><path id="kity_path_361" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M984.5,6382.5C1004.5,6382.5,1004.5,6356.5,1024.5,6356.5"></path><path id="kity_path_363" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M984.5,6382.5C1004.5,6382.5,1004.5,6408.5,1024.5,6408.5"></path><path id="kity_path_365" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M723.5,6311.5C743.5,6311.5,743.5,6773.5,763.5,6773.5"></path><path id="kity_path_367" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M915.5,6773.5C935.5,6773.5,935.5,6564.5,955.5,6564.5"></path><path id="kity_path_369" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6564.5C1019.5,6564.5,1019.5,6460.5,1039.5,6460.5"></path><path id="kity_path_371" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6564.5C1019.5,6564.5,1019.5,6512.5,1039.5,6512.5"></path><path id="kity_path_373" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6564.5C1019.5,6564.5,1019.5,6564.5,1039.5,6564.5"></path><path id="kity_path_375" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6564.5C1019.5,6564.5,1019.5,6616.5,1039.5,6616.5"></path><path id="kity_path_377" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6564.5C1019.5,6564.5,1019.5,6668.5,1039.5,6668.5"></path><path id="kity_path_379" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M915.5,6773.5C935.5,6773.5,935.5,6738.5,955.5,6738.5"></path><path id="kity_path_381" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1011.5,6738.5C1031.5,6738.5,1031.5,6738.5,1051.5,6738.5"></path><path id="kity_path_383" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M915.5,6773.5C935.5,6773.5,935.5,6834.5,955.5,6834.5"></path><path id="kity_path_385" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1023.5,6834.5C1043.5,6834.5,1043.5,6808.5,1063.5,6808.5"></path><path id="kity_path_387" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M1023.5,6834.5C1043.5,6834.5,1043.5,6860.5,1063.5,6860.5"></path><path id="kity_path_389" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M915.5,6773.5C935.5,6773.5,935.5,6982.5,955.5,6982.5"></path><path id="kity_path_391" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6982.5C1019.5,6982.5,1019.5,6912.5,1039.5,6912.5"></path><path id="kity_path_393" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6982.5C1019.5,6982.5,1019.5,6982.5,1039.5,6982.5"></path><path id="kity_path_395" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M999.5,6982.5C1019.5,6982.5,1019.5,7052.5,1039.5,7052.5"></path><path id="kity_path_397" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M483.5,6324.5C503.5,6324.5,503.5,7186.5,523.5,7186.5"></path><path id="kity_path_399" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,7186.5C587.5,7186.5,587.5,7130.5,607.5,7130.5"></path><path id="kity_path_401" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M699.5,7130.5C719.5,7130.5,719.5,7104.5,739.5,7104.5"></path><path id="kity_path_403" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M699.5,7130.5C719.5,7130.5,719.5,7156.5,739.5,7156.5"></path><path id="kity_path_405" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M567.5,7186.5C587.5,7186.5,587.5,7243.5,607.5,7243.5"></path><path id="kity_path_407" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M729.5,7243.5C749.5,7243.5,749.5,7208.5,769.5,7208.5"></path><path id="kity_path_409" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M729.5,7243.5C749.5,7243.5,749.5,7269.5,769.5,7269.5"></path><path id="kity_path_411" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M119.5,4032.5A217,3431,0,0,0,336.5,7463.5"></path><path id="kity_path_413" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M494.5,7463.5C514.5,7463.5,514.5,7365.5,534.5,7365.5"></path><path id="kity_path_415" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M578.5,7365.5C598.5,7365.5,598.5,7339.5,618.5,7339.5"></path><path id="kity_path_417" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M578.5,7365.5C598.5,7365.5,598.5,7391.5,618.5,7391.5"></path><path id="kity_path_419" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M494.5,7463.5C514.5,7463.5,514.5,7561.5,534.5,7561.5"></path><path id="kity_path_421" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,7561.5C689.5,7561.5,689.5,7444.5,709.5,7444.5"></path><path id="kity_path_423" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,7561.5C689.5,7561.5,689.5,7496.5,709.5,7496.5"></path><path id="kity_path_425" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,7561.5C689.5,7561.5,689.5,7583.5,709.5,7583.5"></path><path id="kity_path_427" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M777.5,7583.5C797.5,7583.5,797.5,7557.5,817.5,7557.5"></path><path id="kity_path_429" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M777.5,7583.5C797.5,7583.5,797.5,7618.5,817.5,7618.5"></path><path id="kity_path_431" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M669.5,7561.5C689.5,7561.5,689.5,7679.5,709.5,7679.5"></path><path id="kity_path_433" fill="none" stroke="rgb(115, 161, 191)" stroke-width="1" d="M832.5,7679.5C852.5,7679.5,852.5,7679.5,872.5,7679.5"></path></g><g id="minder_node1"><path id="node_outline1" fill="rgb(115, 161, 191)" stroke="rgb(115, 161, 191)" d="M25.5,4012.5h188a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-188a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text1" fill="white"><text id="kity_text_22" text-rendering="inherit" font-size="16" dy=".8em" y="4024.5" x="44.5">2、flink分布式运行时</text></g></g><g id="kity_g_12"><path id="kity_path_13" fill="none" stroke="none" d="M44.5,4032.5h0v0h0z"></path></g><g id="kity_g_14"><path id="kity_path_15" fill="none" stroke="none" d="M44.5,4032.5h0v0h0z"></path><path id="kity_path_16" fill="none" stroke="none"></path></g><g id="minder_node2"><g id="node_expander34" style="cursor: pointer;"><path id="kity_path_1217" fill="white" stroke="gray" d="M337.5,612A6,6,0,1,1,325.5,612A6,6,0,1,1,337.5,612"></path><path id="kity_path_1218" fill="none" stroke="gray" d="M327,612L336,612"></path></g><path id="node_outline35" fill="rgb(238, 243, 246)" stroke="rgb(115, 161, 191)" d="M341.5,588.5h204a3,3,0,0,1,3,3v41a3,3,0,0,1,-3,3h-204a3,3,0,0,1,-3,-3v-41a3,3,0,0,1,3,-3z" stroke-width="1"></path><g id="node_text35" fill="black"><text id="kity_text_513" text-rendering="inherit" font-size="14" dy=".8em" y="594" x="358.5">任务和算子链</text><text id="kity_text_514" text-rendering="inherit" font-size="14" dy=".8em" y="615" x="358.5">(Tasks和Operator Chains)</text></g></g><g id="minder_node3"><g id="node_expander3" style="cursor: pointer;"><path id="kity_path_1124" fill="white" stroke="gray" d="M588.5,128.5A6,6,0,1,1,576.5,128.5A6,6,0,1,1,588.5,128.5"></path><path id="kity_path_1125" fill="none" stroke="gray" d="M578,128.5L587,128.5"></path></g><path id="node_outline4" fill="none" stroke="none" d="M593.5,117.5h38a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-38a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text4" fill="black"><text id="kity_text_439" text-rendering="inherit" font-size="12" dy=".8em" y="122.5" x="598.5">tasks</text></g></g><g id="minder_node4"><g id="node_expander1" display="none" style="cursor: pointer;"><path id="kity_path_1118" fill="white" stroke="gray" d="M676.5,103A6,6,0,1,1,664.5,103A6,6,0,1,1,676.5,103"></path><path id="kity_path_1119" fill="none" stroke="gray"></path></g><path id="node_outline2" fill="none" stroke="none" d="M681.5,20.5h299a5,5,0,0,1,5,5v155a5,5,0,0,1,-5,5h-299a5,5,0,0,1,-5,-5v-155a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text2" fill="black"><text id="kity_text_435" text-rendering="inherit" font-size="12" dy=".8em" y="168.5" x="686.5">如示例图，包括5个subtasks，也就是说有5个并行线程</text></g><image id="kity_image_907" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2019-02-15-运行时task和chain.png?raw=true" x="730.5" y="25.5" width="200" height="138"></image></g><g id="minder_node5"><g id="node_expander2" display="none" style="cursor: pointer;"><path id="kity_path_1121" fill="white" stroke="gray" d="M676.5,226.5A6,6,0,1,1,664.5,226.5A6,6,0,1,1,676.5,226.5"></path><path id="kity_path_1122" fill="none" stroke="gray"></path></g><path id="node_outline3" fill="none" stroke="none" d="M681.5,215.5h201a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-201a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text3" fill="black"><text id="kity_text_437" text-rendering="inherit" font-size="12" dy=".8em" y="220.5" x="686.5">每个任务（task）在一个线程中执行</text></g></g><g id="minder_node6"><g id="node_expander6" style="cursor: pointer;"><path id="kity_path_1133" fill="white" stroke="gray" d="M588.5,303.5A6,6,0,1,1,576.5,303.5A6,6,0,1,1,588.5,303.5"></path><path id="kity_path_1134" fill="none" stroke="gray" d="M578,303.5L587,303.5"></path></g><path id="node_outline7" fill="none" stroke="none" d="M593.5,292.5h57a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-57a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text7" fill="black"><text id="kity_text_445" text-rendering="inherit" font-size="12" dy=".8em" y="297.5" x="598.5">task形成</text></g></g><g id="minder_node7"><g id="node_expander4" display="none" style="cursor: pointer;"><path id="kity_path_1127" fill="white" stroke="gray" d="M695.5,277.5A6,6,0,1,1,683.5,277.5A6,6,0,1,1,695.5,277.5"></path><path id="kity_path_1128" fill="none" stroke="gray"></path></g><path id="node_outline5" fill="none" stroke="none" d="M700.5,266.5h696a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-696a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text5" fill="black"><text id="kity_text_441" text-rendering="inherit" font-size="12" dy=".8em" y="271.5" x="705.5">在实际的分布式计算环境中，Flink会将多个运算子任务（ operator subtasks）链接一起（chains）形成分布式计算任务（tasks）</text></g></g><g id="minder_node8"><g id="node_expander5" display="none" style="cursor: pointer;"><path id="kity_path_1130" fill="white" stroke="gray" d="M695.5,329.5A6,6,0,1,1,683.5,329.5A6,6,0,1,1,695.5,329.5"></path><path id="kity_path_1131" fill="none" stroke="gray"></path></g><path id="node_outline6" fill="none" stroke="none" d="M700.5,318.5h573a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-573a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text6" fill="black"><text id="kity_text_443" text-rendering="inherit" font-size="12" dy=".8em" y="323.5" x="705.5">task和subtask关系理解：task可能是一个subtask，也可能是多个operator subtasks chains在一起形成的</text></g></g><g id="minder_node9"><g id="node_expander33" style="cursor: pointer;"><path id="kity_path_1214" fill="white" stroke="gray" d="M588.5,1095.5A6,6,0,1,1,576.5,1095.5A6,6,0,1,1,588.5,1095.5"></path><path id="kity_path_1215" fill="none" stroke="gray" d="M578,1095.5L587,1095.5"></path></g><path id="node_outline34" fill="none" stroke="none" d="M593.5,1084.5h102a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-102a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text34" fill="black"><text id="kity_text_511" text-rendering="inherit" font-size="12" dy=".8em" y="1089.5" x="598.5">operator chains</text></g></g><g id="minder_node10"><g id="node_expander12" style="cursor: pointer;"><path id="kity_path_1151" fill="white" stroke="gray" d="M740.5,538.5A6,6,0,1,1,728.5,538.5A6,6,0,1,1,740.5,538.5"></path><path id="kity_path_1152" fill="none" stroke="gray" d="M730,538.5L739,538.5"></path></g><path id="node_outline13" fill="none" stroke="none" d="M745.5,527.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text13" fill="black"><text id="kity_text_460" text-rendering="inherit" font-size="12" dy=".8em" y="532.5" x="750.5">优点</text></g></g><g id="minder_node11"><g id="node_expander7" display="none" style="cursor: pointer;"><path id="kity_path_1136" fill="white" stroke="gray" d="M824.5,381.5A6,6,0,1,1,812.5,381.5A6,6,0,1,1,824.5,381.5"></path><path id="kity_path_1137" fill="none" stroke="gray"></path></g><path id="node_outline8" fill="none" stroke="none" d="M829.5,370.5h118a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-118a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text8" fill="black"><text id="kity_text_447" text-rendering="inherit" font-size="12" dy=".8em" y="375.5" x="834.5">降低了线程间的切换</text></g></g><g id="minder_node12"><g id="node_expander8" display="none" style="cursor: pointer;"><path id="kity_path_1139" fill="white" stroke="gray" d="M824.5,433.5A6,6,0,1,1,812.5,433.5A6,6,0,1,1,824.5,433.5"></path><path id="kity_path_1140" fill="none" stroke="gray"></path></g><path id="node_outline9" fill="none" stroke="none" d="M829.5,422.5h166a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-166a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text9" fill="black"><text id="kity_text_449" text-rendering="inherit" font-size="12" dy=".8em" y="427.5" x="834.5">减少了数据在与缓冲区的开销</text></g></g><g id="minder_node13"><g id="node_expander10" style="cursor: pointer;"><path id="kity_path_1145" fill="white" stroke="gray" d="M824.5,564.5A6,6,0,1,1,812.5,564.5A6,6,0,1,1,824.5,564.5"></path><path id="kity_path_1146" fill="none" stroke="gray" d="M814,564.5L823,564.5"></path></g><path id="node_outline11" fill="none" stroke="none" d="M829.5,553.5h159a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-159a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text11" fill="black"><text id="kity_text_456" text-rendering="inherit" font-size="12" dy=".8em" y="558.5" x="834.5">减少消息的序列化/反序列化</text></g></g><g id="minder_node14"><g id="node_expander9" display="none" style="cursor: pointer;"><path id="kity_path_1142" fill="white" stroke="gray" d="M1033.5,564.5A6,6,0,1,1,1021.5,564.5A6,6,0,1,1,1033.5,564.5"></path><path id="kity_path_1143" fill="none" stroke="gray"></path></g><path id="node_outline10" fill="none" stroke="none" d="M1038.5,474.5h391a5,5,0,0,1,5,5v170a5,5,0,0,1,-5,5h-391a5,5,0,0,1,-5,-5v-170a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text10" fill="black"><text id="kity_text_451" text-rendering="inherit" font-size="12" dy=".8em" y="583.5" x="1043.5">框中的虚线是operator chain内部的数据流，</text><text id="kity_text_452" text-rendering="inherit" font-size="12" dy=".8em" y="601.5" x="1043.5">这个流内的数据不会经过序列化/反序列化、网络传输，</text><text id="kity_text_453" text-rendering="inherit" font-size="12" dy=".8em" y="619.5" x="1043.5">而是直接将消息对象传递给下游的 ChainOperator 处理。</text><text id="kity_text_454" text-rendering="inherit" font-size="12" dy=".8em" y="637.5" x="1043.5">上面的OperaotrChain就可以看做是一个入度为1，出度为2的operator</text></g><image id="kity_image_908" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2018-10-09-FlinkChains原理.png?raw=true" x="1133.5" y="479.5" width="200" height="99"></image></g><g id="minder_node15"><g id="node_expander11" display="none" style="cursor: pointer;"><path id="kity_path_1148" fill="white" stroke="gray" d="M824.5,695.5A6,6,0,1,1,812.5,695.5A6,6,0,1,1,824.5,695.5"></path><path id="kity_path_1149" fill="none" stroke="gray"></path></g><path id="node_outline12" fill="none" stroke="none" d="M829.5,684.5h238a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-238a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text12" fill="black"><text id="kity_text_458" text-rendering="inherit" font-size="12" dy=".8em" y="689.5" x="834.5">在降低延时的同时减少了系统的总体吞吐量</text></g></g><g id="minder_node16"><g id="node_expander20" style="cursor: pointer;"><path id="kity_path_1175" fill="white" stroke="gray" d="M740.5,826.5A6,6,0,1,1,728.5,826.5A6,6,0,1,1,740.5,826.5"></path><path id="kity_path_1176" fill="none" stroke="gray" d="M730,826.5L739,826.5"></path></g><path id="node_outline21" fill="none" stroke="none" d="M745.5,815.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text21" fill="black"><text id="kity_text_479" text-rendering="inherit" font-size="12" dy=".8em" y="820.5" x="750.5">操作</text></g></g><g id="minder_node17"><g id="node_expander13" display="none" style="cursor: pointer;"><path id="kity_path_1154" fill="white" stroke="gray" d="M824.5,747.5A6,6,0,1,1,812.5,747.5A6,6,0,1,1,824.5,747.5"></path><path id="kity_path_1155" fill="none" stroke="gray"></path></g><path id="node_outline14" fill="none" stroke="none" d="M829.5,736.5h82a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-82a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text14" fill="black"><text id="kity_text_462" text-rendering="inherit" font-size="12" dy=".8em" y="741.5" x="834.5">默认全局开启</text></g></g><g id="minder_node18"><g id="node_expander14" display="none" style="cursor: pointer;"><path id="kity_path_1157" fill="white" stroke="gray" d="M824.5,799.5A6,6,0,1,1,812.5,799.5A6,6,0,1,1,824.5,799.5"></path><path id="kity_path_1158" fill="none" stroke="gray"></path></g><path id="node_outline15" fill="none" stroke="none" d="M829.5,788.5h400a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-400a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text15" fill="black"><text id="kity_text_464" text-rendering="inherit" font-size="12" dy=".8em" y="793.5" x="834.5">全局关闭：StreamExecutionEnvironment.disableOperatorChaining()</text></g></g><g id="minder_node19"><g id="node_expander19" style="cursor: pointer;"><path id="kity_path_1172" fill="white" stroke="gray" d="M824.5,878.5A6,6,0,1,1,812.5,878.5A6,6,0,1,1,824.5,878.5"></path><path id="kity_path_1173" fill="none" stroke="gray" d="M814,878.5L823,878.5"></path></g><path id="node_outline20" fill="none" stroke="none" d="M829.5,840.5h184a5,5,0,0,1,5,5v66a5,5,0,0,1,-5,5h-184a5,5,0,0,1,-5,-5v-66a5,5,0,0,1,5,-5z"></path><g id="node_text20" fill="black"><text id="kity_text_474" text-rendering="inherit" font-size="12" dy=".8em" y="845.5" x="834.5">单独创建和结束</text><text id="kity_text_475" text-rendering="inherit" font-size="12" dy=".8em" y="863.5" x="834.5">在底层，这两个方法都是</text><text id="kity_text_476" text-rendering="inherit" font-size="12" dy=".8em" y="881.5" x="834.5">通过调整operator的 chain 策略</text><text id="kity_text_477" text-rendering="inherit" font-size="12" dy=".8em" y="899.5" x="834.5">（HEAD、NEVER）来实现的</text></g></g><g id="minder_node20"><g id="node_expander16" style="cursor: pointer;"><path id="kity_path_1163" fill="white" stroke="gray" d="M1058.5,852.5A6,6,0,1,1,1046.5,852.5A6,6,0,1,1,1058.5,852.5"></path><path id="kity_path_1164" fill="none" stroke="gray" d="M1048,852.5L1057,852.5"></path></g><path id="node_outline17" fill="none" stroke="none" d="M1063.5,841.5h363a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-363a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text17" fill="black"><text id="kity_text_468" text-rendering="inherit" font-size="12" dy=".8em" y="846.5" x="1068.5">创建：someStream.filter(...).map(...).startNewChain().map(...)</text></g></g><g id="minder_node21"><g id="node_expander15" display="none" style="cursor: pointer;"><path id="kity_path_1160" fill="white" stroke="gray" d="M1471.5,852.5A6,6,0,1,1,1459.5,852.5A6,6,0,1,1,1471.5,852.5"></path><path id="kity_path_1161" fill="none" stroke="gray"></path></g><path id="node_outline16" fill="none" stroke="none" d="M1476.5,841.5h522a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-522a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text16" fill="black"><text id="kity_text_466" text-rendering="inherit" font-size="12" dy=".8em" y="846.5" x="1481.5">startNewChain()来指示从该operator开始一个新的chain（与前面截断，不会被chain到前面）</text></g></g><g id="minder_node22"><g id="node_expander18" style="cursor: pointer;"><path id="kity_path_1169" fill="white" stroke="gray" d="M1058.5,904.5A6,6,0,1,1,1046.5,904.5A6,6,0,1,1,1058.5,904.5"></path><path id="kity_path_1170" fill="none" stroke="gray" d="M1048,904.5L1057,904.5"></path></g><path id="node_outline19" fill="none" stroke="none" d="M1063.5,893.5h308a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-308a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text19" fill="black"><text id="kity_text_472" text-rendering="inherit" font-size="12" dy=".8em" y="898.5" x="1068.5">结束chain：someStream.map(...).disableChaining()</text></g></g><g id="minder_node23"><g id="node_expander17" display="none" style="cursor: pointer;"><path id="kity_path_1166" fill="white" stroke="gray" d="M1416.5,904.5A6,6,0,1,1,1404.5,904.5A6,6,0,1,1,1416.5,904.5"></path><path id="kity_path_1167" fill="none" stroke="gray"></path></g><path id="node_outline18" fill="none" stroke="none" d="M1421.5,893.5h531a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-531a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text18" fill="black"><text id="kity_text_470" text-rendering="inherit" font-size="12" dy=".8em" y="898.5" x="1426.5">disableChaining()来指示指示该operator不参与chaining（不会与前后的operator chain一起）</text></g></g><g id="minder_node24"><g id="node_expander31" style="cursor: pointer;"><path id="kity_path_1208" fill="white" stroke="gray" d="M740.5,1243.5A6,6,0,1,1,728.5,1243.5A6,6,0,1,1,740.5,1243.5"></path><path id="kity_path_1209" fill="none" stroke="gray" d="M730,1243.5L739,1243.5"></path></g><path id="node_outline32" fill="none" stroke="none" d="M745.5,1232.5h162a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-162a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text32" fill="black"><text id="kity_text_505" text-rendering="inherit" font-size="12" dy=".8em" y="1237.5" x="750.5">形成operator chains的条件</text></g></g><g id="minder_node25"><g id="node_expander22" style="cursor: pointer;"><path id="kity_path_1181" fill="white" stroke="gray" d="M952.5,1078.5A6,6,0,1,1,940.5,1078.5A6,6,0,1,1,952.5,1078.5"></path><path id="kity_path_1182" fill="none" stroke="gray" d="M942,1078.5L951,1078.5"></path></g><path id="node_outline23" fill="none" stroke="none" d="M957.5,1067.5h150a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-150a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text23" fill="black"><text id="kity_text_487" text-rendering="inherit" font-size="12" dy=".8em" y="1072.5" x="962.5">operator chains过程例子</text></g></g><g id="minder_node26"><g id="node_expander21" display="none" style="cursor: pointer;"><path id="kity_path_1178" fill="white" stroke="gray" d="M1152.5,1079A6,6,0,1,1,1140.5,1079A6,6,0,1,1,1152.5,1079"></path><path id="kity_path_1179" fill="none" stroke="gray"></path></g><path id="node_outline22" fill="none" stroke="none" d="M1157.5,946.5h335a5,5,0,0,1,5,5v255a5,5,0,0,1,-5,5h-335a5,5,0,0,1,-5,-5v-255a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text22" fill="black"><text id="kity_text_481" text-rendering="inherit" font-size="12" dy=".8em" y="1122.5" x="1162.5">Source并行度为1，</text><text id="kity_text_482" text-rendering="inherit" font-size="12" dy=".8em" y="1140.5" x="1162.5">FlatMap、KeyAggregation、Sink并行度均为2，</text><text id="kity_text_483" text-rendering="inherit" font-size="12" dy=".8em" y="1158.5" x="1162.5">最终以5个并行的线程来执行的优化过程。</text><text id="kity_text_484" text-rendering="inherit" font-size="12" dy=".8em" y="1176.5" x="1162.5">上图中将KeyAggregation和Sink两个operator进行了合并，</text><text id="kity_text_485" text-rendering="inherit" font-size="12" dy=".8em" y="1194.5" x="1162.5">因为这两个合并后并不会改变整体的拓扑结构</text></g><image id="kity_image_909" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2018-10-09-FlinkOperatorChains形成.png?raw=true" x="1224.5" y="951.5" width="200" height="166"></image></g><g id="minder_node27"><g id="node_expander30" style="cursor: pointer;"><path id="kity_path_1205" fill="white" stroke="gray" d="M952.5,1408.5A6,6,0,1,1,940.5,1408.5A6,6,0,1,1,952.5,1408.5"></path><path id="kity_path_1206" fill="none" stroke="gray" d="M942,1408.5L951,1408.5"></path></g><path id="node_outline31" fill="none" stroke="none" d="M957.5,1397.5h334a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-334a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text31" fill="#ff0000"><text id="kity_text_503" text-rendering="inherit" font-size="12" dy=".8em" y="1402.5" x="962.5">并不是任意两个operator就能chain一起的，需要一定的条件 </text></g></g><g id="minder_node28"><g id="node_expander23" display="none" style="cursor: pointer;"><path id="kity_path_1184" fill="white" stroke="gray" d="M1336.5,1252.5A6,6,0,1,1,1324.5,1252.5A6,6,0,1,1,1336.5,1252.5"></path><path id="kity_path_1185" fill="none" stroke="gray"></path></g><path id="node_outline24" fill="none" stroke="none" d="M1341.5,1241.5h145a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-145a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text24" fill="#ff0000"><text id="kity_text_489" text-rendering="inherit" font-size="12" dy=".8em" y="1246.5" x="1346.5">没有禁用Chain-默认开启</text></g></g><g id="minder_node29"><g id="node_expander24" display="none" style="cursor: pointer;"><path id="kity_path_1187" fill="white" stroke="gray" d="M1336.5,1304.5A6,6,0,1,1,1324.5,1304.5A6,6,0,1,1,1336.5,1304.5"></path><path id="kity_path_1188" fill="none" stroke="gray"></path></g><path id="node_outline25" fill="none" stroke="none" d="M1341.5,1293.5h130a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-130a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text25" fill="#ff0000"><text id="kity_text_491" text-rendering="inherit" font-size="12" dy=".8em" y="1298.5" x="1346.5">上下游算子并行度一致</text></g></g><g id="minder_node30"><g id="node_expander25" display="none" style="cursor: pointer;"><path id="kity_path_1190" fill="white" stroke="gray" d="M1336.5,1356.5A6,6,0,1,1,1324.5,1356.5A6,6,0,1,1,1336.5,1356.5"></path><path id="kity_path_1191" fill="none" stroke="gray"></path></g><path id="node_outline26" fill="none" stroke="none" d="M1341.5,1345.5h365a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-365a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text26" fill="#ff0000"><text id="kity_text_493" text-rendering="inherit" font-size="12" dy=".8em" y="1350.5" x="1346.5">下游算子的入度为1（也就是说下游节点没有来自其他节点的输入）</text></g></g><g id="minder_node31"><g id="node_expander26" display="none" style="cursor: pointer;"><path id="kity_path_1193" fill="white" stroke="gray" d="M1336.5,1408.5A6,6,0,1,1,1324.5,1408.5A6,6,0,1,1,1336.5,1408.5"></path><path id="kity_path_1194" fill="none" stroke="gray"></path></g><path id="node_outline27" fill="none" stroke="none" d="M1341.5,1397.5h199a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-199a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text27" fill="#ff0000"><text id="kity_text_495" text-rendering="inherit" font-size="12" dy=".8em" y="1402.5" x="1346.5">上下游算子都在同一个slot group中</text></g></g><g id="minder_node32"><g id="node_expander27" display="none" style="cursor: pointer;"><path id="kity_path_1196" fill="white" stroke="gray" d="M1336.5,1460.5A6,6,0,1,1,1324.5,1460.5A6,6,0,1,1,1336.5,1460.5"></path><path id="kity_path_1197" fill="none" stroke="gray"></path></g><path id="node_outline28" fill="none" stroke="none" d="M1341.5,1449.5h368a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-368a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text28" fill="#ff0000"><text id="kity_text_497" text-rendering="inherit" font-size="12" dy=".8em" y="1454.5" x="1346.5">上下游算子之间没有shuffle（两个算子间数据分区方式是forward）</text></g></g><g id="minder_node33"><g id="node_expander28" display="none" style="cursor: pointer;"><path id="kity_path_1199" fill="white" stroke="gray" d="M1336.5,1512.5A6,6,0,1,1,1324.5,1512.5A6,6,0,1,1,1336.5,1512.5"></path><path id="kity_path_1200" fill="none" stroke="gray"></path></g><path id="node_outline29" fill="none" stroke="none" d="M1341.5,1501.5h513a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-513a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text29" fill="#ff0000"><text id="kity_text_499" text-rendering="inherit" font-size="12" dy=".8em" y="1506.5" x="1346.5">下游的chain策略为ALWAYS（可以与上下游链接，map、flatmap、filter等默认是ALWAYS）</text></g></g><g id="minder_node34"><g id="node_expander29" display="none" style="cursor: pointer;"><path id="kity_path_1202" fill="white" stroke="gray" d="M1336.5,1564.5A6,6,0,1,1,1324.5,1564.5A6,6,0,1,1,1336.5,1564.5"></path><path id="kity_path_1203" fill="none" stroke="gray"></path></g><path id="node_outline30" fill="none" stroke="none" d="M1341.5,1553.5h532a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-532a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text30" fill="#ff0000"><text id="kity_text_501" text-rendering="inherit" font-size="12" dy=".8em" y="1558.5" x="1346.5">上游的chain策略为ALWAYS或HEAD（只能与下游链接，不能与上游链接，Source默认是HEAD）</text></g></g><g id="minder_node35"><g id="node_expander32" display="none" style="cursor: pointer;"><path id="kity_path_1211" fill="white" stroke="gray" d="M740.5,1634.5A6,6,0,1,1,728.5,1634.5A6,6,0,1,1,740.5,1634.5"></path><path id="kity_path_1212" fill="none" stroke="gray"></path></g><path id="node_outline33" fill="none" stroke="none" d="M745.5,1605.5h597a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-597a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text33" fill="black"><text id="kity_text_507" text-rendering="inherit" font-size="12" dy=".8em" y="1610.5" x="750.5">源码及原理思路：Flink内部是通过OperatorChain这个类来将多个operator链在一起形成一个新的operator；</text><text id="kity_text_508" text-rendering="inherit" font-size="12" dy=".8em" y="1628.5" x="750.5">OpeeratorChain是黑盒，对外可见的只有HeadOperator，以及与外部连通的实线输出，</text><text id="kity_text_509" text-rendering="inherit" font-size="12" dy=".8em" y="1646.5" x="750.5">这些输出对应了JobGraph中的JobEdge，在底层通过RecordWriterOutput来实现</text></g></g><g id="minder_node36"><g id="node_expander69" style="cursor: pointer;"><path id="kity_path_1322" fill="white" stroke="gray" d="M337.5,2256.5A6,6,0,1,1,325.5,2256.5A6,6,0,1,1,337.5,2256.5"></path><path id="kity_path_1323" fill="none" stroke="gray" d="M327,2256.5L336,2256.5"></path></g><path id="node_outline70" fill="rgb(238, 243, 246)" stroke="rgb(115, 161, 191)" d="M341.5,2243.5h291a3,3,0,0,1,3,3v20a3,3,0,0,1,-3,3h-291a3,3,0,0,1,-3,-3v-20a3,3,0,0,1,3,-3z" stroke-width="1"></path><g id="node_text70" fill="black"><text id="kity_text_593" text-rendering="inherit" font-size="14" dy=".8em" y="2249.5" x="358.5">Job Managers, Task Managers, Clients</text></g></g><g id="minder_node37"><g id="node_expander41" style="cursor: pointer;"><path id="kity_path_1238" fill="white" stroke="gray" d="M675.5,1792.5A6,6,0,1,1,663.5,1792.5A6,6,0,1,1,675.5,1792.5"></path><path id="kity_path_1239" fill="none" stroke="gray" d="M665,1792.5L674,1792.5"></path></g><path id="node_outline42" fill="none" stroke="none" d="M680.5,1763.5h170a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-170a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text42" fill="black"><text id="kity_text_528" text-rendering="inherit" font-size="12" dy=".8em" y="1768.5" x="685.5">Job Managers</text><text id="kity_text_529" text-rendering="inherit" font-size="12" dy=".8em" y="1786.5" x="685.5">作业管理器（也称为master）</text><text id="kity_text_530" text-rendering="inherit" font-size="12" dy=".8em" y="1804.5" x="685.5">独立的JVM 进程</text></g></g><g id="minder_node38"><g id="node_expander37" style="cursor: pointer;"><path id="kity_path_1226" fill="white" stroke="gray" d="M895.5,1740.5A6,6,0,1,1,883.5,1740.5A6,6,0,1,1,895.5,1740.5"></path><path id="kity_path_1227" fill="none" stroke="gray" d="M885,1740.5L894,1740.5"></path></g><path id="node_outline38" fill="none" stroke="none" d="M900.5,1729.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text38" fill="black"><text id="kity_text_520" text-rendering="inherit" font-size="12" dy=".8em" y="1734.5" x="905.5">功能</text></g></g><g id="minder_node39"><g id="node_expander35" display="none" style="cursor: pointer;"><path id="kity_path_1220" fill="white" stroke="gray" d="M979.5,1714.5A6,6,0,1,1,967.5,1714.5A6,6,0,1,1,979.5,1714.5"></path><path id="kity_path_1221" fill="none" stroke="gray"></path></g><path id="node_outline36" fill="none" stroke="none" d="M984.5,1703.5h579a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-579a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text36" fill="black"><text id="kity_text_516" text-rendering="inherit" font-size="12" dy=".8em" y="1708.5" x="989.5">用于协调程序的分布式执行。它的主要功能是调度job，协调任务（tasks），协调checkpoint，故障恢复等</text></g></g><g id="minder_node40"><g id="node_expander36" display="none" style="cursor: pointer;"><path id="kity_path_1223" fill="white" stroke="gray" d="M979.5,1766.5A6,6,0,1,1,967.5,1766.5A6,6,0,1,1,979.5,1766.5"></path><path id="kity_path_1224" fill="none" stroke="gray"></path></g><path id="node_outline37" fill="none" stroke="none" d="M984.5,1755.5h634a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-634a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text37" fill="black"><text id="kity_text_518" text-rendering="inherit" font-size="12" dy=".8em" y="1760.5" x="989.5">从Client处接收到Job和JAR包等资源后，会生成优化后的执行计划，并以Task的单元调度到各个TaskManager去执行</text></g></g><g id="minder_node41"><g id="node_expander40" style="cursor: pointer;"><path id="kity_path_1235" fill="white" stroke="gray" d="M895.5,1844.5A6,6,0,1,1,883.5,1844.5A6,6,0,1,1,895.5,1844.5"></path><path id="kity_path_1236" fill="none" stroke="gray" d="M885,1844.5L894,1844.5"></path></g><path id="node_outline41" fill="none" stroke="none" d="M900.5,1833.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text41" fill="black"><text id="kity_text_526" text-rendering="inherit" font-size="12" dy=".8em" y="1838.5" x="905.5">数量</text></g></g><g id="minder_node42"><g id="node_expander38" display="none" style="cursor: pointer;"><path id="kity_path_1229" fill="white" stroke="gray" d="M979.5,1818.5A6,6,0,1,1,967.5,1818.5A6,6,0,1,1,979.5,1818.5"></path><path id="kity_path_1230" fill="none" stroke="gray"></path></g><path id="node_outline39" fill="none" stroke="none" d="M984.5,1807.5h230a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-230a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text39" fill="black"><text id="kity_text_522" text-rendering="inherit" font-size="12" dy=".8em" y="1812.5" x="989.5">每个Flink环境中至少一个JobManager；</text></g></g><g id="minder_node43"><g id="node_expander39" display="none" style="cursor: pointer;"><path id="kity_path_1232" fill="white" stroke="gray" d="M979.5,1870.5A6,6,0,1,1,967.5,1870.5A6,6,0,1,1,979.5,1870.5"></path><path id="kity_path_1233" fill="none" stroke="gray"></path></g><path id="node_outline40" fill="none" stroke="none" d="M984.5,1859.5h380a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-380a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text40" fill="black"><text id="kity_text_524" text-rendering="inherit" font-size="12" dy=".8em" y="1864.5" x="989.5">高可用会包含多个JobManagers，其中一个是leader，其他standby</text></g></g><g id="minder_node44"><g id="node_expander48" style="cursor: pointer;"><path id="kity_path_1259" fill="white" stroke="gray" d="M675.5,2040.5A6,6,0,1,1,663.5,2040.5A6,6,0,1,1,675.5,2040.5"></path><path id="kity_path_1260" fill="none" stroke="gray" d="M665,2040.5L674,2040.5"></path></g><path id="node_outline49" fill="none" stroke="none" d="M680.5,2011.5h169a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-169a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text49" fill="black"><text id="kity_text_545" text-rendering="inherit" font-size="12" dy=".8em" y="2016.5" x="685.5">Task Managers</text><text id="kity_text_546" text-rendering="inherit" font-size="12" dy=".8em" y="2034.5" x="685.5">任务管理器（也称为worker）</text><text id="kity_text_547" text-rendering="inherit" font-size="12" dy=".8em" y="2052.5" x="685.5">独立的JVM 进程</text></g></g><g id="minder_node45"><g id="node_expander45" style="cursor: pointer;"><path id="kity_path_1250" fill="white" stroke="gray" d="M894.5,1984.5A6,6,0,1,1,882.5,1984.5A6,6,0,1,1,894.5,1984.5"></path><path id="kity_path_1251" fill="none" stroke="gray" d="M884,1984.5L893,1984.5"></path></g><path id="node_outline46" fill="none" stroke="none" d="M899.5,1973.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text46" fill="black"><text id="kity_text_539" text-rendering="inherit" font-size="12" dy=".8em" y="1978.5" x="904.5">功能</text></g></g><g id="minder_node46"><g id="node_expander42" display="none" style="cursor: pointer;"><path id="kity_path_1241" fill="white" stroke="gray" d="M978.5,1923.5A6,6,0,1,1,966.5,1923.5A6,6,0,1,1,978.5,1923.5"></path><path id="kity_path_1242" fill="none" stroke="gray"></path></g><path id="node_outline43" fill="none" stroke="none" d="M983.5,1912.5h462a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-462a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text43" fill="black"><text id="kity_text_532" text-rendering="inherit" font-size="12" dy=".8em" y="1917.5" x="988.5">用于执行dataflow的tasks（更准确地说，是subtasks），并对数据流进行缓冲、交换</text></g></g><g id="minder_node47"><g id="node_expander43" display="none" style="cursor: pointer;"><path id="kity_path_1244" fill="white" stroke="gray" d="M978.5,1984.5A6,6,0,1,1,966.5,1984.5A6,6,0,1,1,978.5,1984.5"></path><path id="kity_path_1245" fill="none" stroke="gray"></path></g><path id="node_outline44" fill="none" stroke="none" d="M983.5,1964.5h567a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-567a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text44" fill="black"><text id="kity_text_534" text-rendering="inherit" font-size="12" dy=".8em" y="1969.5" x="988.5">在启动的时候就设置好了槽位数（Slot），每个slot能启动一个Task，Task为线程。</text><text id="kity_text_535" text-rendering="inherit" font-size="12" dy=".8em" y="1987.5" x="988.5">从JobManager处接收需要部署的Task，部署启动后，与自己的上游建立 Netty 连接，接收数据并处理。</text></g></g><g id="minder_node48"><g id="node_expander44" display="none" style="cursor: pointer;"><path id="kity_path_1247" fill="white" stroke="gray" d="M978.5,2045.5A6,6,0,1,1,966.5,2045.5A6,6,0,1,1,978.5,2045.5"></path><path id="kity_path_1248" fill="none" stroke="gray"></path></g><path id="node_outline45" fill="none" stroke="none" d="M983.5,2034.5h626a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-626a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text45" fill="black"><text id="kity_text_537" text-rendering="inherit" font-size="12" dy=".8em" y="2039.5" x="988.5">启动之后，TaskManagers会连接到JobManagers来宣布自己可用报告自身的状态，便于JobManagers来分配工作</text></g></g><g id="minder_node49"><g id="node_expander47" style="cursor: pointer;"><path id="kity_path_1256" fill="white" stroke="gray" d="M894.5,2097.5A6,6,0,1,1,882.5,2097.5A6,6,0,1,1,894.5,2097.5"></path><path id="kity_path_1257" fill="none" stroke="gray" d="M884,2097.5L893,2097.5"></path></g><path id="node_outline48" fill="none" stroke="none" d="M899.5,2086.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text48" fill="black"><text id="kity_text_543" text-rendering="inherit" font-size="12" dy=".8em" y="2091.5" x="904.5">数量</text></g></g><g id="minder_node50"><g id="node_expander46" display="none" style="cursor: pointer;"><path id="kity_path_1253" fill="white" stroke="gray" d="M978.5,2097.5A6,6,0,1,1,966.5,2097.5A6,6,0,1,1,978.5,2097.5"></path><path id="kity_path_1254" fill="none" stroke="gray"></path></g><path id="node_outline47" fill="none" stroke="none" d="M983.5,2086.5h249a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-249a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text47" fill="black"><text id="kity_text_541" text-rendering="inherit" font-size="12" dy=".8em" y="2091.5" x="988.5">每个Flink环境中至少包含一个TaskManagers</text></g></g><g id="minder_node51"><g id="node_expander53" style="cursor: pointer;"><path id="kity_path_1274" fill="white" stroke="gray" d="M675.5,2200.5A6,6,0,1,1,663.5,2200.5A6,6,0,1,1,675.5,2200.5"></path><path id="kity_path_1275" fill="none" stroke="gray" d="M665,2200.5L674,2200.5"></path></g><path id="node_outline54" fill="none" stroke="none" d="M680.5,2189.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text54" fill="black"><text id="kity_text_557" text-rendering="inherit" font-size="12" dy=".8em" y="2194.5" x="685.5">集群启动</text></g></g><g id="minder_node52"><g id="node_expander52" style="cursor: pointer;"><path id="kity_path_1271" fill="white" stroke="gray" d="M783.5,2200.5A6,6,0,1,1,771.5,2200.5A6,6,0,1,1,783.5,2200.5"></path><path id="kity_path_1272" fill="none" stroke="gray" d="M773,2200.5L782,2200.5"></path></g><path id="node_outline53" fill="none" stroke="none" d="M788.5,2189.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text53" fill="black"><text id="kity_text_555" text-rendering="inherit" font-size="12" dy=".8em" y="2194.5" x="793.5">启动方式</text></g></g><g id="minder_node53"><g id="node_expander49" display="none" style="cursor: pointer;"><path id="kity_path_1262" fill="white" stroke="gray" d="M891.5,2148.5A6,6,0,1,1,879.5,2148.5A6,6,0,1,1,891.5,2148.5"></path><path id="kity_path_1263" fill="none" stroke="gray"></path></g><path id="node_outline50" fill="none" stroke="none" d="M896.5,2137.5h117a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-117a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text50" fill="black"><text id="kity_text_549" text-rendering="inherit" font-size="12" dy=".8em" y="2142.5" x="901.5">standalone cluster</text></g></g><g id="minder_node54"><g id="node_expander50" display="none" style="cursor: pointer;"><path id="kity_path_1265" fill="white" stroke="gray" d="M891.5,2200.5A6,6,0,1,1,879.5,2200.5A6,6,0,1,1,891.5,2200.5"></path><path id="kity_path_1266" fill="none" stroke="gray"></path></g><path id="node_outline51" fill="none" stroke="none" d="M896.5,2189.5h46a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-46a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text51" fill="black"><text id="kity_text_551" text-rendering="inherit" font-size="12" dy=".8em" y="2194.5" x="901.5">容器中</text></g></g><g id="minder_node55"><g id="node_expander51" display="none" style="cursor: pointer;"><path id="kity_path_1268" fill="white" stroke="gray" d="M891.5,2252.5A6,6,0,1,1,879.5,2252.5A6,6,0,1,1,891.5,2252.5"></path><path id="kity_path_1269" fill="none" stroke="gray"></path></g><path id="node_outline52" fill="none" stroke="none" d="M896.5,2241.5h318a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-318a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text52" fill="black"><text id="kity_text_553" text-rendering="inherit" font-size="12" dy=".8em" y="2246.5" x="901.5">resource frameworks：YARN或Mesos等资源框架来管理</text></g></g><g id="minder_node56"><g id="node_expander57" style="cursor: pointer;"><path id="kity_path_1286" fill="white" stroke="gray" d="M675.5,2356.5A6,6,0,1,1,663.5,2356.5A6,6,0,1,1,675.5,2356.5"></path><path id="kity_path_1287" fill="none" stroke="gray" d="M665,2356.5L674,2356.5"></path></g><path id="node_outline58" fill="none" stroke="none" d="M680.5,2327.5h127a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-127a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text58" fill="black"><text id="kity_text_565" text-rendering="inherit" font-size="12" dy=".8em" y="2332.5" x="685.5">client</text><text id="kity_text_566" text-rendering="inherit" font-size="12" dy=".8em" y="2350.5" x="685.5">(不是运行时的一部分)</text><text id="kity_text_567" text-rendering="inherit" font-size="12" dy=".8em" y="2368.5" x="685.5">独立的JVM 进程</text></g></g><g id="minder_node57"><g id="node_expander54" display="none" style="cursor: pointer;"><path id="kity_path_1277" fill="white" stroke="gray" d="M852.5,2304.5A6,6,0,1,1,840.5,2304.5A6,6,0,1,1,852.5,2304.5"></path><path id="kity_path_1278" fill="none" stroke="gray"></path></g><path id="node_outline55" fill="none" stroke="none" d="M857.5,2293.5h637a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-637a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text55" fill="black"><text id="kity_text_559" text-rendering="inherit" font-size="12" dy=".8em" y="2298.5" x="862.5">Client其实并不是运行时及程序执行时的一个组成部分，而是被用来准备和发送的数据流(dataflow)给JobManager的</text></g></g><g id="minder_node58"><g id="node_expander55" display="none" style="cursor: pointer;"><path id="kity_path_1280" fill="white" stroke="gray" d="M852.5,2356.5A6,6,0,1,1,840.5,2356.5A6,6,0,1,1,852.5,2356.5"></path><path id="kity_path_1281" fill="none" stroke="gray"></path></g><path id="node_outline56" fill="none" stroke="none" d="M857.5,2345.5h432a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-432a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text56" fill="black"><text id="kity_text_561" text-rendering="inherit" font-size="12" dy=".8em" y="2350.5" x="862.5">提交Job的客户端，可以是运行在任何机器上（与JobManager环境连通即可）</text></g></g><g id="minder_node59"><g id="node_expander56" display="none" style="cursor: pointer;"><path id="kity_path_1283" fill="white" stroke="gray" d="M852.5,2408.5A6,6,0,1,1,840.5,2408.5A6,6,0,1,1,852.5,2408.5"></path><path id="kity_path_1284" fill="none" stroke="gray"></path></g><path id="node_outline57" fill="none" stroke="none" d="M857.5,2397.5h665a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-665a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text57" fill="black"><text id="kity_text_563" text-rendering="inherit" font-size="12" dy=".8em" y="2402.5" x="862.5">在发送完dataflow之后（提交Job后），可以选择断开与JobManager的连接，或继续保持连接以接收程序运行的进度报告</text></g></g><g id="minder_node60"><g id="node_expander68" style="cursor: pointer;"><path id="kity_path_1319" fill="white" stroke="gray" d="M675.5,2738.5A6,6,0,1,1,663.5,2738.5A6,6,0,1,1,675.5,2738.5"></path><path id="kity_path_1320" fill="none" stroke="gray" d="M665,2738.5L674,2738.5"></path></g><path id="node_outline69" fill="none" stroke="none" d="M680.5,2727.5h70a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-70a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text69" fill="black"><text id="kity_text_591" text-rendering="inherit" font-size="12" dy=".8em" y="2732.5" x="685.5">关系架构图</text></g></g><g id="minder_node61"><g id="node_expander58" display="none" style="cursor: pointer;"><path id="kity_path_1289" fill="white" stroke="gray" d="M795.5,2527A6,6,0,1,1,783.5,2527A6,6,0,1,1,795.5,2527"></path><path id="kity_path_1290" fill="none" stroke="gray"></path></g><path id="node_outline59" fill="none" stroke="none" d="M800.5,2450.5h210a5,5,0,0,1,5,5v143a5,5,0,0,1,-5,5h-210a5,5,0,0,1,-5,-5v-143a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text59" fill="black"><text id="kity_text_569" text-rendering="inherit" font-size="12" dy=".8em" y="2586.5" x="904.5"> </text></g><image id="kity_image_910" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2019-02-15-运行时关系架构图.png?raw=true" x="805.5" y="2455.5" width="200" height="126"></image></g><g id="minder_node62"><g id="node_expander59" display="none" style="cursor: pointer;"><path id="kity_path_1292" fill="white" stroke="gray" d="M795.5,2644.5A6,6,0,1,1,783.5,2644.5A6,6,0,1,1,795.5,2644.5"></path><path id="kity_path_1293" fill="none" stroke="gray"></path></g><path id="node_outline60" fill="none" stroke="none" d="M800.5,2633.5h604a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-604a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text60" fill="black"><text id="kity_text_571" text-rendering="inherit" font-size="12" dy=".8em" y="2638.5" x="805.5">Flink运行时角色间的通信使用akka（Client，JobManager，TaskManager之间通信），数据的传输使用netty</text></g></g><g id="minder_node63"><g id="node_expander65" style="cursor: pointer;"><path id="kity_path_1310" fill="white" stroke="gray" d="M795.5,2812.5A6,6,0,1,1,783.5,2812.5A6,6,0,1,1,795.5,2812.5"></path><path id="kity_path_1311" fill="none" stroke="gray" d="M785,2812.5L794,2812.5"></path></g><path id="node_outline66" fill="none" stroke="none" d="M800.5,2801.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text66" fill="black"><text id="kity_text_583" text-rendering="inherit" font-size="12" dy=".8em" y="2806.5" x="805.5">过程总结</text></g></g><g id="minder_node64"><g id="node_expander60" display="none" style="cursor: pointer;"><path id="kity_path_1295" fill="white" stroke="gray" d="M903.5,2700.5A6,6,0,1,1,891.5,2700.5A6,6,0,1,1,903.5,2700.5"></path><path id="kity_path_1296" fill="none" stroke="gray"></path></g><path id="node_outline61" fill="none" stroke="none" d="M908.5,2685.5h510a5,5,0,0,1,5,5v20a5,5,0,0,1,-5,5h-510a5,5,0,0,1,-5,-5v-20a5,5,0,0,1,5,-5z"></path><g id="node_text61" fill="black"><text id="kity_text_573" text-rendering="inherit" font-size="12" dy=".8em" y="2694.5" x="938.5">当Flink集群启动后，首先会启动一个（或HA）JobManger和一个或多个的TaskManager</text></g><g id="node_priority1"><path id="kity_path_888" fill="#840023" stroke="none" d="M914,2704c0,3.866,3.134,7,7,7h6c3.866,0,7,-3.134,7,-7V2698H914V2704z"></path><path id="kity_path_889" fill="#FF1200" stroke="none" d="M934,2701c0,3.866,-3.134,7,-7,7H921c-3.866,0,-7,-3.134,-7,-7V2698c0,-3.866,3.134,-7,7,-7h6c3.866,0,7,3.134,7,7V2701z" opacity="0.8"></path><text id="kity_text_890" text-rendering="geometricPrecision" x="923" y="2700.5" text-anchor="middle" font-style="italic" font-size="12" fill="white" dy="4.3203125">1</text></g></g><g id="minder_node65"><g id="node_expander61" display="none" style="cursor: pointer;"><path id="kity_path_1298" fill="white" stroke="gray" d="M903.5,2760.5A6,6,0,1,1,891.5,2760.5A6,6,0,1,1,903.5,2760.5"></path><path id="kity_path_1299" fill="none" stroke="gray"></path></g><path id="node_outline62" fill="none" stroke="none" d="M908.5,2745.5h217a5,5,0,0,1,5,5v20a5,5,0,0,1,-5,5h-217a5,5,0,0,1,-5,-5v-20a5,5,0,0,1,5,-5z"></path><g id="node_text62" fill="black"><text id="kity_text_575" text-rendering="inherit" font-size="12" dy=".8em" y="2754.5" x="938.5">由Client提交任务给JobManager</text></g><g id="node_priority2"><path id="kity_path_893" fill="#01467F" stroke="none" d="M914,2764c0,3.866,3.134,7,7,7h6c3.866,0,7,-3.134,7,-7V2758H914V2764z"></path><path id="kity_path_894" fill="#0074FF" stroke="none" d="M934,2761c0,3.866,-3.134,7,-7,7H921c-3.866,0,-7,-3.134,-7,-7V2758c0,-3.866,3.134,-7,7,-7h6c3.866,0,7,3.134,7,7V2761z" opacity="0.8"></path><text id="kity_text_895" text-rendering="geometricPrecision" x="923" y="2760.5" text-anchor="middle" font-style="italic" font-size="12" fill="white" dy="4.3203125">2</text></g></g><g id="minder_node66"><g id="node_expander62" display="none" style="cursor: pointer;"><path id="kity_path_1301" fill="white" stroke="gray" d="M903.5,2820.5A6,6,0,1,1,891.5,2820.5A6,6,0,1,1,903.5,2820.5"></path><path id="kity_path_1302" fill="none" stroke="gray"></path></g><path id="node_outline63" fill="none" stroke="none" d="M908.5,2805.5h321a5,5,0,0,1,5,5v20a5,5,0,0,1,-5,5h-321a5,5,0,0,1,-5,-5v-20a5,5,0,0,1,5,-5z"></path><g id="node_text63" fill="black"><text id="kity_text_577" text-rendering="inherit" font-size="12" dy=".8em" y="2814.5" x="938.5">JobManager再调度任务到各个TaskManager去执行</text></g><g id="node_priority3"><path id="kity_path_898" fill="#006300" stroke="none" d="M914,2824c0,3.866,3.134,7,7,7h6c3.866,0,7,-3.134,7,-7V2818H914V2824z"></path><path id="kity_path_899" fill="#00AF00" stroke="none" d="M934,2821c0,3.866,-3.134,7,-7,7H921c-3.866,0,-7,-3.134,-7,-7V2818c0,-3.866,3.134,-7,7,-7h6c3.866,0,7,3.134,7,7V2821z" opacity="0.8"></path><text id="kity_text_900" text-rendering="geometricPrecision" x="923" y="2820.5" text-anchor="middle" font-style="italic" font-size="12" fill="white" dy="4.3203125">3</text></g></g><g id="minder_node67"><g id="node_expander63" display="none" style="cursor: pointer;"><path id="kity_path_1304" fill="white" stroke="gray" d="M903.5,2876.5A6,6,0,1,1,891.5,2876.5A6,6,0,1,1,903.5,2876.5"></path><path id="kity_path_1305" fill="none" stroke="gray"></path></g><path id="node_outline64" fill="none" stroke="none" d="M908.5,2865.5h296a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-296a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text64" fill="black"><text id="kity_text_579" text-rendering="inherit" font-size="12" dy=".8em" y="2870.5" x="913.5">TaskManager将心跳和统计信息汇报给JobManager</text></g></g><g id="minder_node68"><g id="node_expander64" display="none" style="cursor: pointer;"><path id="kity_path_1307" fill="white" stroke="gray" d="M903.5,2928.5A6,6,0,1,1,891.5,2928.5A6,6,0,1,1,903.5,2928.5"></path><path id="kity_path_1308" fill="none" stroke="gray"></path></g><path id="node_outline65" fill="none" stroke="none" d="M908.5,2917.5h259a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-259a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text65" fill="black"><text id="kity_text_581" text-rendering="inherit" font-size="12" dy=".8em" y="2922.5" x="913.5">TaskManager 之间以流的形式进行数据的传输</text></g></g><g id="minder_node69"><g id="node_expander67" style="cursor: pointer;"><path id="kity_path_1316" fill="white" stroke="gray" d="M795.5,2998.5A6,6,0,1,1,783.5,2998.5A6,6,0,1,1,795.5,2998.5"></path><path id="kity_path_1317" fill="none" stroke="gray" d="M785,2998.5L794,2998.5"></path></g><path id="node_outline68" fill="none" stroke="none" d="M800.5,2969.5h488a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-488a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text68" fill="black"><text id="kity_text_587" text-rendering="inherit" font-size="12" dy=".8em" y="2974.5" x="830.5">Flink的任务调度是多线程模型，并且不同Job/Task混合在一个TaskManager进程中。</text><text id="kity_text_588" text-rendering="inherit" font-size="12" dy=".8em" y="2992.5" x="830.5">虽然这种方式可以有效提高CPU利用率，资源隔离如何实现？？？</text><text id="kity_text_589" text-rendering="inherit" font-size="12" dy=".8em" y="3010.5" x="830.5">Storm的进程模型，一个JVM中只跑该Job的Tasks实际应用中更为合理？？？？？</text></g><g id="node_progress1"><path id="kity_path_902" fill="#FFED83" stroke="none" d="M825,2999A9,9,0,1,1,807,2999A9,9,0,1,1,825,2999"></path><path id="kity_path_903" fill="#43BC00" stroke="none" d="M816,2999L825,2999A9,9,0,0,1,807,2999A9,9,0,0,1,825,2999L816,2999z"></path><path id="kity_path_904" fill="#8E8E8E" stroke="none" d="M816,2992c4.418,0,8,3.582,8,8h1c0,-5.523,-3.477,-10,-9,-10S807,2994.477,807,3000h1C808,2995.582,811.582,2992,816,2992z"></path><path id="kity_path_906" fill="#EEE" stroke="none" d="M821.812,2996.896l-6.75,6.75l-4.5,-4.5L812.25,2997.459l2.812,2.803l5.062,-5.053L821.812,2996.896z"></path><path id="kity_path_905" fill="url(#kity_linearGradient_17)" stroke="none" d="M816,2989C810.477,2989,806,2993.477,806,2999c0,5.523,4.477,10,10,10s10,-4.477,10,-10C826,2993.477,821.523,2989,816,2989zM816,3007c-4.418,0,-8,-3.582,-8,-8s3.582,-8,8,-8s8,3.582,8,8S820.418,3007,816,3007z"></path></g></g><g id="minder_node70"><g id="node_expander66" display="none" style="cursor: pointer;"><path id="kity_path_1313" fill="white" stroke="gray" d="M1333.5,2998.5A6,6,0,1,1,1321.5,2998.5A6,6,0,1,1,1333.5,2998.5"></path><path id="kity_path_1314" fill="none" stroke="gray"></path></g><path id="node_outline67" fill="none" stroke="none" d="M1338.5,2987.5h138a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-138a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text67" fill="black"><text id="kity_text_585" text-rendering="inherit" font-size="12" dy=".8em" y="2992.5" x="1343.5">解决：task solt、group</text></g></g><g id="minder_node71"><g id="node_expander137" style="cursor: pointer;"><path id="kity_path_1526" fill="white" stroke="gray" d="M337.5,4238.5A6,6,0,1,1,325.5,4238.5A6,6,0,1,1,337.5,4238.5"></path><path id="kity_path_1527" fill="none" stroke="gray" d="M327,4238.5L336,4238.5"></path></g><path id="node_outline138" fill="rgb(238, 243, 246)" stroke="rgb(115, 161, 191)" d="M341.5,4225.5h198a3,3,0,0,1,3,3v20a3,3,0,0,1,-3,3h-198a3,3,0,0,1,-3,-3v-20a3,3,0,0,1,3,-3z" stroke-width="1"></path><g id="node_text138" fill="black"><text id="kity_text_740" text-rendering="inherit" font-size="14" dy=".8em" y="4231.5" x="358.5">Task Slots and Resources</text></g></g><g id="minder_node72"><g id="node_expander91" style="cursor: pointer;"><path id="kity_path_1388" fill="white" stroke="gray" d="M582.5,3310.5A6,6,0,1,1,570.5,3310.5A6,6,0,1,1,582.5,3310.5"></path><path id="kity_path_1389" fill="none" stroke="gray" d="M572,3310.5L581,3310.5"></path></g><path id="node_outline92" fill="none" stroke="none" d="M587.5,3290.5h157a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-157a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text92" fill="black"><text id="kity_text_638" text-rendering="inherit" font-size="12" dy=".8em" y="3295.5" x="592.5">TaskManager和Slot的关系</text><text id="kity_text_639" text-rendering="inherit" font-size="12" dy=".8em" y="3313.5" x="592.5">-资源隔离，控制task数量</text></g></g><g id="minder_node73"><g id="node_expander71" style="cursor: pointer;"><path id="kity_path_1328" fill="white" stroke="gray" d="M789.5,3078.5A6,6,0,1,1,777.5,3078.5A6,6,0,1,1,789.5,3078.5"></path><path id="kity_path_1329" fill="none" stroke="gray" d="M779,3078.5L788,3078.5"></path></g><path id="node_outline72" fill="none" stroke="none" d="M794.5,3067.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text72" fill="black"><text id="kity_text_597" text-rendering="inherit" font-size="12" dy=".8em" y="3072.5" x="799.5">引入原因</text></g></g><g id="minder_node74"><g id="node_expander70" display="none" style="cursor: pointer;"><path id="kity_path_1325" fill="white" stroke="gray" d="M897.5,3078.5A6,6,0,1,1,885.5,3078.5A6,6,0,1,1,897.5,3078.5"></path><path id="kity_path_1326" fill="none" stroke="gray"></path></g><path id="node_outline71" fill="none" stroke="none" d="M902.5,3067.5h717a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-717a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text71" fill="black"><text id="kity_text_595" text-rendering="inherit" font-size="12" dy=".8em" y="3072.5" x="907.5">每个worker都是一个独立的JVM进程，运行一个或多个subtask在其不同的线程中;task slots为了控制worker接收任务（tasks）的数量</text></g></g><g id="minder_node75"><g id="node_expander73" style="cursor: pointer;"><path id="kity_path_1334" fill="white" stroke="gray" d="M789.5,3130.5A6,6,0,1,1,777.5,3130.5A6,6,0,1,1,789.5,3130.5"></path><path id="kity_path_1335" fill="none" stroke="gray" d="M779,3130.5L788,3130.5"></path></g><path id="node_outline74" fill="none" stroke="none" d="M794.5,3119.5h182a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-182a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text74" fill="black"><text id="kity_text_601" text-rendering="inherit" font-size="12" dy=".8em" y="3124.5" x="799.5">taskmanager中最高并发task数</text></g></g><g id="minder_node76"><g id="node_expander72" display="none" style="cursor: pointer;"><path id="kity_path_1331" fill="white" stroke="gray" d="M1021.5,3130.5A6,6,0,1,1,1009.5,3130.5A6,6,0,1,1,1021.5,3130.5"></path><path id="kity_path_1332" fill="none" stroke="gray"></path></g><path id="node_outline73" fill="none" stroke="none" d="M1026.5,3119.5h347a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-347a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text73" fill="black"><text id="kity_text_599" text-rendering="inherit" font-size="12" dy=".8em" y="3124.5" x="1031.5">TaskManager最多能同时并发执行的任务，不能超过slot的数量</text></g></g><g id="minder_node77"><g id="node_expander78" style="cursor: pointer;"><path id="kity_path_1349" fill="white" stroke="gray" d="M789.5,3234.5A6,6,0,1,1,777.5,3234.5A6,6,0,1,1,789.5,3234.5"></path><path id="kity_path_1350" fill="none" stroke="gray" d="M779,3234.5L788,3234.5"></path></g><path id="node_outline79" fill="none" stroke="none" d="M794.5,3223.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text79" fill="black"><text id="kity_text_611" text-rendering="inherit" font-size="12" dy=".8em" y="3228.5" x="799.5">资源隔离</text></g></g><g id="minder_node78"><g id="node_expander74" display="none" style="cursor: pointer;"><path id="kity_path_1337" fill="white" stroke="gray" d="M897.5,3182.5A6,6,0,1,1,885.5,3182.5A6,6,0,1,1,897.5,3182.5"></path><path id="kity_path_1338" fill="none" stroke="gray"></path></g><path id="node_outline75" fill="none" stroke="none" d="M902.5,3171.5h516a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-516a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text75" fill="black"><text id="kity_text_603" text-rendering="inherit" font-size="12" dy=".8em" y="3176.5" x="907.5">每个task slots代表TaskManager中一个特定的资源池子集，槽把TaskManager的资源进行平分</text></g></g><g id="minder_node79"><g id="node_expander75" display="none" style="cursor: pointer;"><path id="kity_path_1340" fill="white" stroke="gray" d="M897.5,3234.5A6,6,0,1,1,885.5,3234.5A6,6,0,1,1,897.5,3234.5"></path><path id="kity_path_1341" fill="none" stroke="gray"></path></g><path id="node_outline76" fill="none" stroke="none" d="M902.5,3223.5h494a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-494a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text76" fill="black"><text id="kity_text_605" text-rendering="inherit" font-size="12" dy=".8em" y="3228.5" x="907.5">将资源池solt化可以让subtask获取指定容量的内存资源，而避免同其他job中的subtask竞争</text></g></g><g id="minder_node80"><g id="node_expander77" style="cursor: pointer;"><path id="kity_path_1346" fill="white" stroke="gray" d="M897.5,3286.5A6,6,0,1,1,885.5,3286.5A6,6,0,1,1,897.5,3286.5"></path><path id="kity_path_1347" fill="none" stroke="gray" d="M887,3286.5L896,3286.5"></path></g><path id="node_outline78" fill="none" stroke="none" d="M902.5,3275.5h94a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-94a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text78" fill="#ff0000"><text id="kity_text_609" text-rendering="inherit" font-size="12" dy=".8em" y="3280.5" x="907.5">注意：仅内存！</text></g></g><g id="minder_node81"><g id="node_expander76" display="none" style="cursor: pointer;"><path id="kity_path_1343" fill="white" stroke="gray" d="M1041.5,3286.5A6,6,0,1,1,1029.5,3286.5A6,6,0,1,1,1041.5,3286.5"></path><path id="kity_path_1344" fill="none" stroke="gray"></path></g><path id="node_outline77" fill="none" stroke="none" d="M1046.5,3275.5h359a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-359a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text77" fill="black"><text id="kity_text_607" text-rendering="inherit" font-size="12" dy=".8em" y="3280.5" x="1051.5">这里没有对CPU进行隔离；目前task solt仅仅用于隔离tasks的内存</text></g></g><g id="minder_node82"><g id="node_expander90" style="cursor: pointer;"><path id="kity_path_1385" fill="white" stroke="gray" d="M789.5,3543.5A6,6,0,1,1,777.5,3543.5A6,6,0,1,1,789.5,3543.5"></path><path id="kity_path_1386" fill="none" stroke="gray" d="M779,3543.5L788,3543.5"></path></g><path id="node_outline91" fill="none" stroke="none" d="M794.5,3532.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text91" fill="black"><text id="kity_text_636" text-rendering="inherit" font-size="12" dy=".8em" y="3537.5" x="799.5">数量设置</text></g></g><g id="minder_node83"><g id="node_expander79" display="none" style="cursor: pointer;"><path id="kity_path_1352" fill="white" stroke="gray" d="M897.5,3338.5A6,6,0,1,1,885.5,3338.5A6,6,0,1,1,897.5,3338.5"></path><path id="kity_path_1353" fill="none" stroke="gray"></path></g><path id="node_outline80" fill="none" stroke="none" d="M902.5,3327.5h289a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-289a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text80" fill="black"><text id="kity_text_613" text-rendering="inherit" font-size="12" dy=".8em" y="3332.5" x="907.5">每个worker(TaskManager)中至少包含一个task slot</text></g></g><g id="minder_node84"><g id="node_expander88" style="cursor: pointer;"><path id="kity_path_1379" fill="white" stroke="gray" d="M897.5,3480.5A6,6,0,1,1,885.5,3480.5A6,6,0,1,1,897.5,3480.5"></path><path id="kity_path_1380" fill="none" stroke="gray" d="M887,3480.5L896,3480.5"></path></g><path id="node_outline89" fill="none" stroke="none" d="M902.5,3469.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text89" fill="black"><text id="kity_text_632" text-rendering="inherit" font-size="12" dy=".8em" y="3474.5" x="907.5">调整数量</text></g></g><g id="minder_node85"><g id="node_expander81" style="cursor: pointer;"><path id="kity_path_1358" fill="white" stroke="gray" d="M1005.5,3391.5A6,6,0,1,1,993.5,3391.5A6,6,0,1,1,1005.5,3391.5"></path><path id="kity_path_1359" fill="none" stroke="gray" d="M995,3391.5L1004,3391.5"></path></g><path id="node_outline82" fill="none" stroke="none" d="M1010.5,3380.5h70a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-70a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text82" fill="black"><text id="kity_text_617" text-rendering="inherit" font-size="12" dy=".8em" y="3385.5" x="1015.5">只有一个槽</text></g></g><g id="minder_node86"><g id="node_expander80" display="none" style="cursor: pointer;"><path id="kity_path_1355" fill="white" stroke="gray" d="M1125.5,3391.5A6,6,0,1,1,1113.5,3391.5A6,6,0,1,1,1125.5,3391.5"></path><path id="kity_path_1356" fill="none" stroke="gray"></path></g><path id="node_outline81" fill="none" stroke="none" d="M1130.5,3380.5h240a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-240a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text81" fill="black"><text id="kity_text_615" text-rendering="inherit" font-size="12" dy=".8em" y="3385.5" x="1135.5">每个task group都运行在一个独立的JVM中</text></g></g><g id="minder_node87"><g id="node_expander87" style="cursor: pointer;"><path id="kity_path_1376" fill="white" stroke="gray" d="M1005.5,3570.5A6,6,0,1,1,993.5,3570.5A6,6,0,1,1,1005.5,3570.5"></path><path id="kity_path_1377" fill="none" stroke="gray" d="M995,3570.5L1004,3570.5"></path></g><path id="node_outline88" fill="none" stroke="none" d="M1010.5,3559.5h46a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-46a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text88" fill="black"><text id="kity_text_630" text-rendering="inherit" font-size="12" dy=".8em" y="3564.5" x="1015.5">多个槽</text></g></g><g id="minder_node88"><g id="node_expander82" display="none" style="cursor: pointer;"><path id="kity_path_1361" fill="white" stroke="gray" d="M1101.5,3443.5A6,6,0,1,1,1089.5,3443.5A6,6,0,1,1,1101.5,3443.5"></path><path id="kity_path_1362" fill="none" stroke="gray"></path></g><path id="node_outline83" fill="none" stroke="none" d="M1106.5,3432.5h412a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-412a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text83" fill="black"><text id="kity_text_619" text-rendering="inherit" font-size="12" dy=".8em" y="3437.5" x="1111.5">TaskManager 有多个槽就意味着会有更多的子任务subtask共享同一个JVM</text></g></g><g id="minder_node89"><g id="node_expander85" style="cursor: pointer;"><path id="kity_path_1370" fill="white" stroke="gray" d="M1101.5,3530.5A6,6,0,1,1,1089.5,3530.5A6,6,0,1,1,1101.5,3530.5"></path><path id="kity_path_1371" fill="none" stroke="gray" d="M1091,3530.5L1100,3530.5"></path></g><path id="node_outline86" fill="none" stroke="none" d="M1106.5,3519.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text86" fill="black"><text id="kity_text_626" text-rendering="inherit" font-size="12" dy=".8em" y="3524.5" x="1111.5">优势</text></g></g><g id="minder_node90"><g id="node_expander83" display="none" style="cursor: pointer;"><path id="kity_path_1364" fill="white" stroke="gray" d="M1185.5,3504.5A6,6,0,1,1,1173.5,3504.5A6,6,0,1,1,1185.5,3504.5"></path><path id="kity_path_1365" fill="none" stroke="gray"></path></g><path id="node_outline84" fill="none" stroke="none" d="M1190.5,3484.5h538a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-538a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text84" fill="black"><text id="kity_text_621" text-rendering="inherit" font-size="12" dy=".8em" y="3489.5" x="1195.5">在同一个JVM中的任务会共享 TCP连接（通过多路复用（multiplexing）的方式）和共享心跳信息，</text><text id="kity_text_622" text-rendering="inherit" font-size="12" dy=".8em" y="3507.5" x="1195.5">可以减少数据的网络传输</text></g></g><g id="minder_node91"><g id="node_expander84" display="none" style="cursor: pointer;"><path id="kity_path_1367" fill="white" stroke="gray" d="M1185.5,3565.5A6,6,0,1,1,1173.5,3565.5A6,6,0,1,1,1185.5,3565.5"></path><path id="kity_path_1368" fill="none" stroke="gray"></path></g><path id="node_outline85" fill="none" stroke="none" d="M1190.5,3554.5h357a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-357a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text85" fill="black"><text id="kity_text_624" text-rendering="inherit" font-size="12" dy=".8em" y="3559.5" x="1195.5">也会共享数据集和数据结构，一定程度上可以降低每个task的开销</text></g></g><g id="minder_node92"><g id="node_expander86" display="none" style="cursor: pointer;"><path id="kity_path_1373" fill="white" stroke="gray" d="M1101.5,3657.5A6,6,0,1,1,1089.5,3657.5A6,6,0,1,1,1101.5,3657.5"></path><path id="kity_path_1374" fill="none" stroke="gray"></path></g><path id="node_outline87" fill="none" stroke="none" d="M1106.5,3606.5h210a5,5,0,0,1,5,5v92a5,5,0,0,1,-5,5h-210a5,5,0,0,1,-5,-5v-92a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text87" fill="black"><text id="kity_text_628" text-rendering="inherit" font-size="12" dy=".8em" y="3691.5" x="1155.5">wordcount分布示例</text></g><image id="kity_image_911" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2018-10-09-FlinkSlot分布例子.png?raw=true" x="1111.5" y="3611.5" width="200" height="75"></image></g><g id="minder_node93"><g id="node_expander89" display="none" style="cursor: pointer;"><path id="kity_path_1382" fill="white" stroke="gray" d="M897.5,3748.5A6,6,0,1,1,885.5,3748.5A6,6,0,1,1,897.5,3748.5"></path><path id="kity_path_1383" fill="none" stroke="gray"></path></g><path id="node_outline90" fill="none" stroke="none" d="M902.5,3737.5h547a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-547a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text90" fill="#ff0000"><text id="kity_text_634" text-rendering="inherit" font-size="12" dy=".8em" y="3742.5" x="907.5">经验上讲Slot的数量与CPU-core的数量一致为好。但考虑到超线程，可以让slotNumber=2*cpuCore</text></g></g><g id="minder_node94"><g id="node_expander121" style="cursor: pointer;"><path id="kity_path_1478" fill="white" stroke="gray" d="M582.5,4258.5A6,6,0,1,1,570.5,4258.5A6,6,0,1,1,582.5,4258.5"></path><path id="kity_path_1479" fill="none" stroke="gray" d="M572,4258.5L581,4258.5"></path></g><path id="node_outline122" fill="none" stroke="none" d="M587.5,4247.5h77a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-77a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text122" fill="black"><text id="kity_text_706" text-rendering="inherit" font-size="12" dy=".8em" y="4252.5" x="592.5">slot共享机制</text></g></g><g id="minder_node95"><g id="node_expander94" style="cursor: pointer;"><path id="kity_path_1397" fill="white" stroke="gray" d="M709.5,3834.5A6,6,0,1,1,697.5,3834.5A6,6,0,1,1,709.5,3834.5"></path><path id="kity_path_1398" fill="none" stroke="gray" d="M699,3834.5L708,3834.5"></path></g><path id="node_outline95" fill="none" stroke="none" d="M714.5,3823.5h89a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-89a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text95" fill="black"><text id="kity_text_646" text-rendering="inherit" font-size="12" dy=".8em" y="3828.5" x="719.5">solt共享的概念</text></g></g><g id="minder_node96"><g id="node_expander92" display="none" style="cursor: pointer;"><path id="kity_path_1391" fill="white" stroke="gray" d="M848.5,3808.5A6,6,0,1,1,836.5,3808.5A6,6,0,1,1,848.5,3808.5"></path><path id="kity_path_1392" fill="none" stroke="gray"></path></g><path id="node_outline93" fill="none" stroke="none" d="M853.5,3788.5h690a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-690a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text93" fill="black"><text id="kity_text_641" text-rendering="inherit" font-size="12" dy=".8em" y="3793.5" x="858.5">默认情况下，Flink允许subtasks共享slot，即Flink会允许同一个作业（job）中来自不同的task的多个subtasks共享一个槽，</text><text id="kity_text_642" text-rendering="inherit" font-size="12" dy=".8em" y="3811.5" x="858.5">即前提是他们来自同一个job，哪怕不同task也可以。这种情况下，可以使得同一个slot运行一个完整的job的流水线（pipleline）</text></g></g><g id="minder_node97"><g id="node_expander93" display="none" style="cursor: pointer;"><path id="kity_path_1394" fill="white" stroke="gray" d="M848.5,3869.5A6,6,0,1,1,836.5,3869.5A6,6,0,1,1,848.5,3869.5"></path><path id="kity_path_1395" fill="none" stroke="gray"></path></g><path id="node_outline94" fill="none" stroke="none" d="M853.5,3858.5h124a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-124a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text94" fill="#ff0000"><text id="kity_text_644" text-rendering="inherit" font-size="12" dy=".8em" y="3863.5" x="858.5">注意前提：同一个job</text></g></g><g id="minder_node98"><g id="node_expander106" style="cursor: pointer;"><path id="kity_path_1433" fill="white" stroke="gray" d="M709.5,4137.5A6,6,0,1,1,697.5,4137.5A6,6,0,1,1,709.5,4137.5"></path><path id="kity_path_1434" fill="none" stroke="gray" d="M699,4137.5L708,4137.5"></path></g><path id="node_outline107" fill="none" stroke="none" d="M714.5,4126.5h113a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-113a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text107" fill="black"><text id="kity_text_676" text-rendering="inherit" font-size="12" dy=".8em" y="4131.5" x="719.5">使用solt共享的优势</text></g></g><g id="minder_node99"><g id="node_expander95" display="none" style="cursor: pointer;"><path id="kity_path_1400" fill="white" stroke="gray" d="M872.5,3931.5A6,6,0,1,1,860.5,3931.5A6,6,0,1,1,872.5,3931.5"></path><path id="kity_path_1401" fill="none" stroke="gray"></path></g><path id="node_outline96" fill="none" stroke="none" d="M877.5,3911.5h720a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-720a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text96" fill="black"><text id="kity_text_648" text-rendering="inherit" font-size="12" dy=".8em" y="3916.5" x="882.5">Flink集群需要与job程序中使用的最高并行度（highest parallelism ）一样多的solt，因此只需计算Job中最高并行度（parallelism），</text><text id="kity_text_649" text-rendering="inherit" font-size="12" dy=".8em" y="3934.5" x="882.5">只要这个满足，其他的job也都能满足，因此不需要去计算一个程序中一共会起多少个task</text></g></g><g id="minder_node100"><g id="node_expander100" style="cursor: pointer;"><path id="kity_path_1415" fill="white" stroke="gray" d="M872.5,4097.5A6,6,0,1,1,860.5,4097.5A6,6,0,1,1,872.5,4097.5"></path><path id="kity_path_1416" fill="none" stroke="gray" d="M862,4097.5L871,4097.5"></path></g><path id="node_outline101" fill="none" stroke="none" d="M877.5,4077.5h281a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-281a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text101" fill="black"><text id="kity_text_662" text-rendering="inherit" font-size="12" dy=".8em" y="4082.5" x="882.5">如果有比较空闲的slot可以将更多的任务分配给它，</text><text id="kity_text_663" text-rendering="inherit" font-size="12" dy=".8em" y="4100.5" x="882.5">可以提高资源利用率。</text></g></g><g id="minder_node101"><g id="node_expander96" display="none" style="cursor: pointer;"><path id="kity_path_1403" fill="white" stroke="gray" d="M1203.5,3992.5A6,6,0,1,1,1191.5,3992.5A6,6,0,1,1,1203.5,3992.5"></path><path id="kity_path_1404" fill="none" stroke="gray"></path></g><path id="node_outline97" fill="none" stroke="none" d="M1208.5,3981.5h288a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-288a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text97" fill="black"><text id="kity_text_651" text-rendering="inherit" font-size="12" dy=".8em" y="3986.5" x="1213.5">非密集型（non-intensive）如source/map()子任务</text></g></g><g id="minder_node102"><g id="node_expander97" display="none" style="cursor: pointer;"><path id="kity_path_1406" fill="white" stroke="gray" d="M1203.5,4044.5A6,6,0,1,1,1191.5,4044.5A6,6,0,1,1,1203.5,4044.5"></path><path id="kity_path_1407" fill="none" stroke="gray"></path></g><path id="node_outline98" fill="none" stroke="none" d="M1208.5,4033.5h214a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-214a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text98" fill="black"><text id="kity_text_653" text-rendering="inherit" font-size="12" dy=".8em" y="4038.5" x="1213.5">密集型（intensive）如window子任务</text></g></g><g id="minder_node103"><g id="node_expander98" display="none" style="cursor: pointer;"><path id="kity_path_1409" fill="white" stroke="gray" d="M1203.5,4105.5A6,6,0,1,1,1191.5,4105.5A6,6,0,1,1,1203.5,4105.5"></path><path id="kity_path_1410" fill="none" stroke="gray"></path></g><path id="node_outline99" fill="none" stroke="none" d="M1208.5,4085.5h450a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-450a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text99" fill="black"><text id="kity_text_655" text-rendering="inherit" font-size="12" dy=".8em" y="4090.5" x="1213.5">若没有任务槽共享，有时候负载不高的Source/Map等subtask将会占据许多资源，</text><text id="kity_text_656" text-rendering="inherit" font-size="12" dy=".8em" y="4108.5" x="1213.5">而负载较高的窗口subtask则会缺乏资源</text></g></g><g id="minder_node104"><g id="node_expander99" display="none" style="cursor: pointer;"><path id="kity_path_1412" fill="white" stroke="gray" d="M1203.5,4184.5A6,6,0,1,1,1191.5,4184.5A6,6,0,1,1,1203.5,4184.5"></path><path id="kity_path_1413" fill="none" stroke="gray"></path></g><path id="node_outline100" fill="none" stroke="none" d="M1208.5,4155.5h523a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-523a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text100" fill="black"><text id="kity_text_658" text-rendering="inherit" font-size="12" dy=".8em" y="4160.5" x="1213.5">如果有任务槽共享机制，通过提高程序的基础并发量，</text><text id="kity_text_659" text-rendering="inherit" font-size="12" dy=".8em" y="4178.5" x="1213.5">就可以让密集型子任务（heavy subtasks）公平的完全分散到任务管理器（TaskManager）中，</text><text id="kity_text_660" text-rendering="inherit" font-size="12" dy=".8em" y="4196.5" x="1213.5">从而可以显著提高槽的资源利用率充分利用资源</text></g></g><g id="minder_node105"><g id="node_expander105" style="cursor: pointer;"><path id="kity_path_1430" fill="white" stroke="gray" d="M872.5,4304A6,6,0,1,1,860.5,4304A6,6,0,1,1,872.5,4304"></path><path id="kity_path_1431" fill="none" stroke="gray" d="M862,4304L871,4304"></path></g><path id="node_outline106" fill="none" stroke="none" d="M877.5,4243.5h297a5,5,0,0,1,5,5v111a5,5,0,0,1,-5,5h-297a5,5,0,0,1,-5,-5v-111a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text106" fill="black"><text id="kity_text_674" text-rendering="inherit" font-size="12" dy=".8em" y="4347.5" x="882.5">例子：上述wordcount开启solt共享并且提高并行度后</text></g><image id="kity_image_912" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2018-10-09-slot共享示例.png?raw=true" x="925.5" y="4248.5" width="200" height="94"></image></g><g id="minder_node106"><g id="node_expander101" display="none" style="cursor: pointer;"><path id="kity_path_1418" fill="white" stroke="gray" d="M1219.5,4265.5A6,6,0,1,1,1207.5,4265.5A6,6,0,1,1,1219.5,4265.5"></path><path id="kity_path_1419" fill="none" stroke="gray"></path></g><path id="node_outline102" fill="none" stroke="none" d="M1224.5,4245.5h438a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-438a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text102" fill="black"><text id="kity_text_665" text-rendering="inherit" font-size="12" dy=".8em" y="4250.5" x="1229.5">操作：将WordCount的并行度从之前的2个增加到6个（Source并行度仍为1），</text><text id="kity_text_666" text-rendering="inherit" font-size="12" dy=".8em" y="4268.5" x="1229.5">并开启slot共享（所有operator都在default共享组）</text></g></g><g id="minder_node107"><g id="node_expander104" style="cursor: pointer;"><path id="kity_path_1427" fill="white" stroke="gray" d="M1219.5,4352.5A6,6,0,1,1,1207.5,4352.5A6,6,0,1,1,1219.5,4352.5"></path><path id="kity_path_1428" fill="none" stroke="gray" d="M1209,4352.5L1218,4352.5"></path></g><path id="node_outline105" fill="none" stroke="none" d="M1224.5,4341.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text105" fill="black"><text id="kity_text_672" text-rendering="inherit" font-size="12" dy=".8em" y="4346.5" x="1229.5">优势体现</text></g></g><g id="minder_node108"><g id="node_expander102" display="none" style="cursor: pointer;"><path id="kity_path_1421" fill="white" stroke="gray" d="M1327.5,4326.5A6,6,0,1,1,1315.5,4326.5A6,6,0,1,1,1327.5,4326.5"></path><path id="kity_path_1422" fill="none" stroke="gray"></path></g><path id="node_outline103" fill="none" stroke="none" d="M1332.5,4315.5h544a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-544a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text103" fill="black"><text id="kity_text_668" text-rendering="inherit" font-size="12" dy=".8em" y="4320.5" x="1337.5">首先，我们不用去计算这个job会其多少个task，总之该任务最终会占用6个slots（最高并行度为6）。</text></g></g><g id="minder_node109"><g id="node_expander103" display="none" style="cursor: pointer;"><path id="kity_path_1424" fill="white" stroke="gray" d="M1327.5,4378.5A6,6,0,1,1,1315.5,4378.5A6,6,0,1,1,1327.5,4378.5"></path><path id="kity_path_1425" fill="none" stroke="gray"></path></g><path id="node_outline104" fill="none" stroke="none" d="M1332.5,4367.5h484a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-484a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text104" fill="black"><text id="kity_text_670" text-rendering="inherit" font-size="12" dy=".8em" y="4372.5" x="1337.5">其次，我们可以看到密集型操作keyAggregation/sink被平均地分配到各个TaskManager</text></g></g><g id="minder_node110"><g id="node_expander120" style="cursor: pointer;"><path id="kity_path_1475" fill="white" stroke="gray" d="M709.5,4682.5A6,6,0,1,1,697.5,4682.5A6,6,0,1,1,709.5,4682.5"></path><path id="kity_path_1476" fill="none" stroke="gray" d="M699,4682.5L708,4682.5"></path></g><path id="node_outline121" fill="none" stroke="none" d="M714.5,4671.5h149a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-149a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text121" fill="black"><text id="kity_text_704" text-rendering="inherit" font-size="12" dy=".8em" y="4676.5" x="719.5">实现共享slot以及分配策略</text></g></g><g id="minder_node111"><g id="node_expander117" style="cursor: pointer;"><path id="kity_path_1466" fill="white" stroke="gray" d="M908.5,4572.5A6,6,0,1,1,896.5,4572.5A6,6,0,1,1,908.5,4572.5"></path><path id="kity_path_1467" fill="none" stroke="gray" d="M898,4572.5L907,4572.5"></path></g><path id="node_outline118" fill="none" stroke="none" d="M913.5,4561.5h111a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-111a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text118" fill="black"><text id="kity_text_698" text-rendering="inherit" font-size="12" dy=".8em" y="4566.5" x="918.5">SlotSharingGroup</text></g></g><g id="minder_node112"><g id="node_expander110" style="cursor: pointer;"><path id="kity_path_1445" fill="white" stroke="gray" d="M1069.5,4481.5A6,6,0,1,1,1057.5,4481.5A6,6,0,1,1,1069.5,4481.5"></path><path id="kity_path_1446" fill="none" stroke="gray" d="M1059,4481.5L1068,4481.5"></path></g><path id="node_outline111" fill="none" stroke="none" d="M1074.5,4470.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text111" fill="black"><text id="kity_text_684" text-rendering="inherit" font-size="12" dy=".8em" y="4475.5" x="1079.5">概念</text></g></g><g id="minder_node113"><g id="node_expander107" display="none" style="cursor: pointer;"><path id="kity_path_1436" fill="white" stroke="gray" d="M1153.5,4429.5A6,6,0,1,1,1141.5,4429.5A6,6,0,1,1,1153.5,4429.5"></path><path id="kity_path_1437" fill="none" stroke="gray"></path></g><path id="node_outline108" fill="none" stroke="none" d="M1158.5,4418.5h197a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-197a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text108" fill="black"><text id="kity_text_678" text-rendering="inherit" font-size="12" dy=".8em" y="4423.5" x="1163.5">默认slot sharing group是"default"</text></g></g><g id="minder_node114"><g id="node_expander108" display="none" style="cursor: pointer;"><path id="kity_path_1439" fill="white" stroke="gray" d="M1153.5,4481.5A6,6,0,1,1,1141.5,4481.5A6,6,0,1,1,1153.5,4481.5"></path><path id="kity_path_1440" fill="none" stroke="gray"></path></g><path id="node_outline109" fill="none" stroke="none" d="M1158.5,4470.5h1120a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-1120a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text109" fill="black"><text id="kity_text_680" text-rendering="inherit" font-size="12" dy=".8em" y="4475.5" x="1163.5">Flink中用来实现slot共享的类，它尽可能地让subtasks共享一个slot。Flink将把具有相同slot sharing group的 算子操作（operations）放入同一个插槽，同时保持其他插槽中没用此slot sharing group的算子操作</text></g></g><g id="minder_node115"><g id="node_expander109" display="none" style="cursor: pointer;"><path id="kity_path_1442" fill="white" stroke="gray" d="M1153.5,4533.5A6,6,0,1,1,1141.5,4533.5A6,6,0,1,1,1153.5,4533.5"></path><path id="kity_path_1443" fill="none" stroke="gray"></path></g><path id="node_outline110" fill="none" stroke="none" d="M1158.5,4522.5h701a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-701a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text110" fill="black"><text id="kity_text_682" text-rendering="inherit" font-size="12" dy=".8em" y="4527.5" x="1163.5">手动强制指定slot sharing group：someStream.filter(...).slotSharingGroup("name")，就强制指定了filter的slot共享组为name。</text></g></g><g id="minder_node116"><g id="node_expander116" style="cursor: pointer;"><path id="kity_path_1463" fill="white" stroke="gray" d="M1069.5,4663.5A6,6,0,1,1,1057.5,4663.5A6,6,0,1,1,1069.5,4663.5"></path><path id="kity_path_1464" fill="none" stroke="gray" d="M1059,4663.5L1068,4663.5"></path></g><path id="node_outline117" fill="none" stroke="none" d="M1074.5,4652.5h219a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-219a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text117" fill="#ff0000"><text id="kity_text_696" text-rendering="inherit" font-size="12" dy=".8em" y="4657.5" x="1079.5">怎么确定一个算子的SlotSharingGroup</text></g></g><g id="minder_node117"><g id="node_expander111" display="none" style="cursor: pointer;"><path id="kity_path_1448" fill="white" stroke="gray" d="M1338.5,4585.5A6,6,0,1,1,1326.5,4585.5A6,6,0,1,1,1338.5,4585.5"></path><path id="kity_path_1449" fill="none" stroke="gray"></path></g><path id="node_outline112" fill="none" stroke="none" d="M1343.5,4574.5h701a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-701a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text112" fill="black"><text id="kity_text_686" text-rendering="inherit" font-size="12" dy=".8em" y="4579.5" x="1348.5">默认情况下，所有的operator（算子）都属于默认的共享组default，也就是说默认情况下所有的operator都是可以共享一个slot的</text></g></g><g id="minder_node118"><g id="node_expander114" style="cursor: pointer;"><path id="kity_path_1457" fill="white" stroke="gray" d="M1338.5,4663.5A6,6,0,1,1,1326.5,4663.5A6,6,0,1,1,1338.5,4663.5"></path><path id="kity_path_1458" fill="none" stroke="gray" d="M1328,4663.5L1337,4663.5"></path></g><path id="node_outline115" fill="none" stroke="none" d="M1343.5,4652.5h277a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-277a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text115" fill="#ff0000"><text id="kity_text_692" text-rendering="inherit" font-size="12" dy=".8em" y="4657.5" x="1348.5">根据input的group和自身是否设置group共同确定</text></g></g><g id="minder_node119"><g id="node_expander112" display="none" style="cursor: pointer;"><path id="kity_path_1451" fill="white" stroke="gray" d="M1665.5,4637.5A6,6,0,1,1,1653.5,4637.5A6,6,0,1,1,1665.5,4637.5"></path><path id="kity_path_1452" fill="none" stroke="gray"></path></g><path id="node_outline113" fill="none" stroke="none" d="M1670.5,4626.5h432a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-432a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text113" fill="black"><text id="kity_text_688" text-rendering="inherit" font-size="12" dy=".8em" y="4631.5" x="1675.5">当所有input operators具有相同的slot共享组时，该operator会继承这个共享组</text></g></g><g id="minder_node120"><g id="node_expander113" display="none" style="cursor: pointer;"><path id="kity_path_1454" fill="white" stroke="gray" d="M1665.5,4689.5A6,6,0,1,1,1653.5,4689.5A6,6,0,1,1,1665.5,4689.5"></path><path id="kity_path_1455" fill="none" stroke="gray"></path></g><path id="node_outline114" fill="none" stroke="none" d="M1670.5,4678.5h341a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-341a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text114" fill="black"><text id="kity_text_690" text-rendering="inherit" font-size="12" dy=".8em" y="4683.5" x="1675.5">判断是否写代码强制指定：**.slotSharingGroup(“group1”)</text></g></g><g id="minder_node121"><g id="node_expander115" display="none" style="cursor: pointer;"><path id="kity_path_1460" fill="white" stroke="gray" d="M1338.5,4741.5A6,6,0,1,1,1326.5,4741.5A6,6,0,1,1,1338.5,4741.5"></path><path id="kity_path_1461" fill="none" stroke="gray"></path></g><path id="node_outline116" fill="none" stroke="none" d="M1343.5,4730.5h425a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-425a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text116" fill="black"><text id="kity_text_694" text-rendering="inherit" font-size="12" dy=".8em" y="4735.5" x="1348.5">好处：适当的设置可以减少每个slot运行的线程数，从而整体上减少机器的负载</text></g></g><g id="minder_node122"><g id="node_expander119" style="cursor: pointer;"><path id="kity_path_1472" fill="white" stroke="gray" d="M908.5,4793.5A6,6,0,1,1,896.5,4793.5A6,6,0,1,1,908.5,4793.5"></path><path id="kity_path_1473" fill="none" stroke="gray" d="M898,4793.5L907,4793.5"></path></g><path id="node_outline120" fill="none" stroke="none" d="M913.5,4782.5h116a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-116a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text120" fill="black"><text id="kity_text_702" text-rendering="inherit" font-size="12" dy=".8em" y="4787.5" x="918.5">CoLocationGroup</text></g></g><g id="minder_node123"><g id="node_expander118" display="none" style="cursor: pointer;"><path id="kity_path_1469" fill="white" stroke="gray" d="M1074.5,4793.5A6,6,0,1,1,1062.5,4793.5A6,6,0,1,1,1074.5,4793.5"></path><path id="kity_path_1470" fill="none" stroke="gray"></path></g><path id="node_outline119" fill="none" stroke="none" d="M1079.5,4782.5h834a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-834a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text119" fill="black"><text id="kity_text_700" text-rendering="inherit" font-size="12" dy=".8em" y="4787.5" x="1084.5">用来强制将subtasks放到同一个slot中。CoLocationGroup主要用于迭代流中，用来保证迭代头与迭代尾的第i个subtask能被调度到同一个TaskManager上</text></g></g><g id="minder_node124"><g id="node_expander125" style="cursor: pointer;"><path id="kity_path_1490" fill="white" stroke="gray" d="M582.5,4886.5A6,6,0,1,1,570.5,4886.5A6,6,0,1,1,582.5,4886.5"></path><path id="kity_path_1491" fill="none" stroke="gray" d="M572,4886.5L581,4886.5"></path></g><path id="node_outline126" fill="none" stroke="none" d="M587.5,4875.5h149a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-149a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text126" fill="#ff0000"><text id="kity_text_714" text-rendering="inherit" font-size="12" dy=".8em" y="4880.5" x="592.5">一个应用需要多少个slot？</text></g></g><g id="minder_node125"><g id="node_expander122" display="none" style="cursor: pointer;"><path id="kity_path_1481" fill="white" stroke="gray" d="M781.5,4845.5A6,6,0,1,1,769.5,4845.5A6,6,0,1,1,781.5,4845.5"></path><path id="kity_path_1482" fill="none" stroke="gray"></path></g><path id="node_outline123" fill="none" stroke="none" d="M786.5,4834.5h303a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-303a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text123" fill="black"><text id="kity_text_708" text-rendering="inherit" font-size="12" dy=".8em" y="4839.5" x="791.5">不设置SlotSharingGroup的情况下：应用的最大并行度</text></g></g><g id="minder_node126"><g id="node_expander124" style="cursor: pointer;"><path id="kity_path_1487" fill="white" stroke="gray" d="M781.5,4927.5A6,6,0,1,1,769.5,4927.5A6,6,0,1,1,781.5,4927.5"></path><path id="kity_path_1488" fill="none" stroke="gray" d="M771,4927.5L780,4927.5"></path></g><path id="node_outline125" fill="none" stroke="none" d="M786.5,4916.5h379a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-379a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text125" fill="black"><text id="kity_text_712" text-rendering="inherit" font-size="12" dy=".8em" y="4921.5" x="791.5">设置了SlotSharingGroup：所有SlotSharingGroup中最大并行度之和</text></g></g><g id="minder_node127"><g id="node_expander123" display="none" style="cursor: pointer;"><path id="kity_path_1484" fill="white" stroke="gray" d="M1210.5,4928A6,6,0,1,1,1198.5,4928A6,6,0,1,1,1210.5,4928"></path><path id="kity_path_1485" fill="none" stroke="gray"></path></g><path id="node_outline124" fill="none" stroke="none" d="M1215.5,4886.5h552a5,5,0,0,1,5,5v73a5,5,0,0,1,-5,5h-552a5,5,0,0,1,-5,-5v-73a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text124" fill="black"><text id="kity_text_710" text-rendering="inherit" font-size="12" dy=".8em" y="4952.5" x="1220.5">如下图：source时为default，然后在map算子处设置gourp为test，那么这个需要的槽数是10+20=30</text></g><image id="kity_image_913" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2018-10-10-slot和并行度关系.png?raw=true" x="1391.5" y="4891.5" width="200" height="56"></image></g><g id="minder_node128"><g id="node_expander136" style="cursor: pointer;"><path id="kity_path_1523" fill="white" stroke="gray" d="M582.5,5157.5A6,6,0,1,1,570.5,5157.5A6,6,0,1,1,582.5,5157.5"></path><path id="kity_path_1524" fill="none" stroke="gray" d="M572,5157.5L581,5157.5"></path></g><path id="node_outline137" fill="none" stroke="none" d="M587.5,5128.5h113a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-113a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text137" fill="black"><text id="kity_text_736" text-rendering="inherit" font-size="12" dy=".8em" y="5133.5" x="592.5">solt和并行度的关系</text><text id="kity_text_737" text-rendering="inherit" font-size="12" dy=".8em" y="5151.5" x="592.5">-任务调度</text><text id="kity_text_738" text-rendering="inherit" font-size="12" dy=".8em" y="5169.5" x="592.5">-pipeline</text></g></g><g id="minder_node129"><g id="node_expander127" style="cursor: pointer;"><path id="kity_path_1496" fill="white" stroke="gray" d="M745.5,5010.5A6,6,0,1,1,733.5,5010.5A6,6,0,1,1,745.5,5010.5"></path><path id="kity_path_1497" fill="none" stroke="gray" d="M735,5010.5L744,5010.5"></path></g><path id="node_outline128" fill="none" stroke="none" d="M750.5,4999.5h1060a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-1060a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text128" fill="black"><text id="kity_text_718" text-rendering="inherit" font-size="12" dy=".8em" y="5004.5" x="755.5">Flink通过任务槽（Task Slot）定义执行资源，每个TaskManager都有一或多个任务槽，每个任务槽都可以运行一个并行任务流(one pipeline of parallel tasks)，一个流(pipeline)包括多个连续的任务</text></g></g><g id="minder_node130"><g id="node_expander126" display="none" style="cursor: pointer;"><path id="kity_path_1493" fill="white" stroke="gray" d="M1855.5,5010.5A6,6,0,1,1,1843.5,5010.5A6,6,0,1,1,1855.5,5010.5"></path><path id="kity_path_1494" fill="none" stroke="gray"></path></g><path id="node_outline127" fill="none" stroke="none" d="M1860.5,4999.5h89a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-89a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text127" fill="black"><text id="kity_text_716" text-rendering="inherit" font-size="12" dy=".8em" y="5004.5" x="1865.5">solt共享可调整</text></g></g><g id="minder_node131"><g id="node_expander130" style="cursor: pointer;"><path id="kity_path_1505" fill="white" stroke="gray" d="M745.5,5088.5A6,6,0,1,1,733.5,5088.5A6,6,0,1,1,745.5,5088.5"></path><path id="kity_path_1506" fill="none" stroke="gray" d="M735,5088.5L744,5088.5"></path></g><path id="node_outline131" fill="none" stroke="none" d="M750.5,5077.5h190a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-190a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text131" fill="black"><text id="kity_text_724" text-rendering="inherit" font-size="12" dy=".8em" y="5082.5" x="755.5">Flink通常会并行的执行连续的任务</text></g></g><g id="minder_node132"><g id="node_expander128" display="none" style="cursor: pointer;"><path id="kity_path_1499" fill="white" stroke="gray" d="M985.5,5062.5A6,6,0,1,1,973.5,5062.5A6,6,0,1,1,985.5,5062.5"></path><path id="kity_path_1500" fill="none" stroke="gray"></path></g><path id="node_outline129" fill="none" stroke="none" d="M990.5,5051.5h261a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-261a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text129" fill="black"><text id="kity_text_720" text-rendering="inherit" font-size="12" dy=".8em" y="5056.5" x="995.5">对于Streaming程序来说，任何情况都如此执行</text></g></g><g id="minder_node133"><g id="node_expander129" display="none" style="cursor: pointer;"><path id="kity_path_1502" fill="white" stroke="gray" d="M985.5,5114.5A6,6,0,1,1,973.5,5114.5A6,6,0,1,1,985.5,5114.5"></path><path id="kity_path_1503" fill="none" stroke="gray"></path></g><path id="node_outline130" fill="none" stroke="none" d="M990.5,5103.5h217a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-217a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text130" fill="black"><text id="kity_text_722" text-rendering="inherit" font-size="12" dy=".8em" y="5108.5" x="995.5">对于batch 程序，多数情况也如此执行</text></g></g><g id="minder_node134"><g id="node_expander135" style="cursor: pointer;"><path id="kity_path_1520" fill="white" stroke="gray" d="M745.5,5244.5A6,6,0,1,1,733.5,5244.5A6,6,0,1,1,745.5,5244.5"></path><path id="kity_path_1521" fill="none" stroke="gray" d="M735,5244.5L744,5244.5"></path></g><path id="node_outline136" fill="none" stroke="rgb(57, 80, 96)" d="M750.5,5172.5h210a5,5,0,0,1,5,5v134a5,5,0,0,1,-5,5h-210a5,5,0,0,1,-5,-5v-134a5,5,0,0,1,5,-5z" stroke-width="3"></path><g id="node_text136" fill="black"><text id="kity_text_734" text-rendering="inherit" font-size="12" dy=".8em" y="5299.5" x="810.5">Scheduling示例</text></g><image id="kity_image_914" xlink:href="https://github.com/leafming/bak/blob/master/images/flink/2019-02-15-task和并行度.png?raw=true" x="755.5" y="5177.5" width="200" height="117"></image></g><g id="minder_node135"><g id="node_expander131" display="none" style="cursor: pointer;"><path id="kity_path_1508" fill="white" stroke="gray" d="M1005.5,5166.5A6,6,0,1,1,993.5,5166.5A6,6,0,1,1,1005.5,5166.5"></path><path id="kity_path_1509" fill="none" stroke="gray"></path></g><path id="node_outline132" fill="none" stroke="none" d="M1010.5,5155.5h419a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-419a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text132" fill="black"><text id="kity_text_726" text-rendering="inherit" font-size="12" dy=".8em" y="5160.5" x="1015.5">在具有2个TaskManager，每个TaskManager都有3个Task Slot的集群上运行</text></g></g><g id="minder_node136"><g id="node_expander132" display="none" style="cursor: pointer;"><path id="kity_path_1511" fill="white" stroke="gray" d="M1005.5,5218.5A6,6,0,1,1,993.5,5218.5A6,6,0,1,1,1005.5,5218.5"></path><path id="kity_path_1512" fill="none" stroke="gray"></path></g><path id="node_outline133" fill="none" stroke="none" d="M1010.5,5207.5h422a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-422a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text133" fill="black"><text id="kity_text_728" text-rendering="inherit" font-size="12" dy=".8em" y="5212.5" x="1015.5">由一个data source、一个MapFunction和一个ReduceFunction组成的程序</text></g></g><g id="minder_node137"><g id="node_expander133" display="none" style="cursor: pointer;"><path id="kity_path_1514" fill="white" stroke="gray" d="M1005.5,5270.5A6,6,0,1,1,993.5,5270.5A6,6,0,1,1,1005.5,5270.5"></path><path id="kity_path_1515" fill="none" stroke="gray"></path></g><path id="node_outline134" fill="none" stroke="none" d="M1010.5,5259.5h435a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-435a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text134" fill="black"><text id="kity_text_730" text-rendering="inherit" font-size="12" dy=".8em" y="5264.5" x="1015.5">data source和MapFunction的并发度都为4，而ReduceFunction的并发度为3</text></g></g><g id="minder_node138"><g id="node_expander134" display="none" style="cursor: pointer;"><path id="kity_path_1517" fill="white" stroke="gray" d="M1005.5,5322.5A6,6,0,1,1,993.5,5322.5A6,6,0,1,1,1005.5,5322.5"></path><path id="kity_path_1518" fill="none" stroke="gray"></path></g><path id="node_outline135" fill="none" stroke="none" d="M1010.5,5311.5h870a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-870a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text135" fill="black"><text id="kity_text_732" text-rendering="inherit" font-size="12" dy=".8em" y="5316.5" x="1015.5">一个数据流由Source-Map-Reduce的顺序组成，一个MapFunction的第n个并行实例与一个ReduceFunction的第n个并行实例的连续任务可以组成一个pipeline</text></g></g><g id="minder_node139"><g id="node_expander190" style="cursor: pointer;"><path id="kity_path_1685" fill="white" stroke="gray" d="M337.5,6324.5A6,6,0,1,1,325.5,6324.5A6,6,0,1,1,337.5,6324.5"></path><path id="kity_path_1686" fill="none" stroke="gray" d="M327,6324.5L336,6324.5"></path></g><path id="node_outline191" fill="rgb(238, 243, 246)" stroke="rgb(115, 161, 191)" d="M341.5,6311.5h139a3,3,0,0,1,3,3v20a3,3,0,0,1,-3,3h-139a3,3,0,0,1,-3,-3v-20a3,3,0,0,1,3,-3z" stroke-width="1"></path><g id="node_text191" fill="black"><text id="kity_text_859" text-rendering="inherit" font-size="14" dy=".8em" y="6317.5" x="358.5">State Backends</text></g></g><g id="minder_node140"><g id="node_expander142" style="cursor: pointer;"><path id="kity_path_1541" fill="white" stroke="gray" d="M523.5,5462.5A6,6,0,1,1,511.5,5462.5A6,6,0,1,1,523.5,5462.5"></path><path id="kity_path_1542" fill="none" stroke="gray" d="M513,5462.5L522,5462.5"></path></g><path id="node_outline143" fill="none" stroke="none" d="M528.5,5451.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text143" fill="black"><text id="kity_text_750" text-rendering="inherit" font-size="12" dy=".8em" y="5456.5" x="533.5">概念</text></g></g><g id="minder_node141"><g id="node_expander138" display="none" style="cursor: pointer;"><path id="kity_path_1529" fill="white" stroke="gray" d="M607.5,5384.5A6,6,0,1,1,595.5,5384.5A6,6,0,1,1,607.5,5384.5"></path><path id="kity_path_1530" fill="none" stroke="gray"></path></g><path id="node_outline139" fill="none" stroke="none" d="M612.5,5373.5h1074a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-1074a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text139" fill="#548dd4"><text id="kity_text_742" text-rendering="inherit" font-size="12" dy=".8em" y="5378.5" x="617.5">当检查点（checkpoint）机制启动时，状态将在检查点中持久化来应对数据丢失以及恢复。而状态在内部是如何表示的、状态是如何持久化到检查点中以及持久化到哪里都取决于选定的State Backend</text></g></g><g id="minder_node142"><g id="node_expander139" display="none" style="cursor: pointer;"><path id="kity_path_1532" fill="white" stroke="gray" d="M607.5,5436.5A6,6,0,1,1,595.5,5436.5A6,6,0,1,1,607.5,5436.5"></path><path id="kity_path_1533" fill="none" stroke="gray"></path></g><path id="node_outline140" fill="none" stroke="none" d="M612.5,5425.5h376a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-376a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text140" fill="black"><text id="kity_text_744" text-rendering="inherit" font-size="12" dy=".8em" y="5430.5" x="617.5">Flink提供了不同的state backend，用于指定state的存储方式和位置</text></g></g><g id="minder_node143"><g id="node_expander140" display="none" style="cursor: pointer;"><path id="kity_path_1535" fill="white" stroke="gray" d="M607.5,5488.5A6,6,0,1,1,595.5,5488.5A6,6,0,1,1,607.5,5488.5"></path><path id="kity_path_1536" fill="none" stroke="gray"></path></g><path id="node_outline141" fill="none" stroke="none" d="M612.5,5477.5h329a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-329a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text141" fill="black"><text id="kity_text_746" text-rendering="inherit" font-size="12" dy=".8em" y="5482.5" x="617.5">存储键/值索引的确切数据结构取决于所选的State Backend</text></g></g><g id="minder_node144"><g id="node_expander141" display="none" style="cursor: pointer;"><path id="kity_path_1538" fill="white" stroke="gray" d="M607.5,5540.5A6,6,0,1,1,595.5,5540.5A6,6,0,1,1,607.5,5540.5"></path><path id="kity_path_1539" fill="none" stroke="gray"></path></g><path id="node_outline142" fill="none" stroke="none" d="M612.5,5529.5h1199a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-1199a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text142" fill="black"><text id="kity_text_748" text-rendering="inherit" font-size="12" dy=".8em" y="5534.5" x="617.5">有的后端存储将数据保存在内存中的哈希表中，而有的存储会使用RocksDB来保存键值对。除了定义保存状态的数据结构之外，后端存储还实现了获取键值对的特定时间点快照的功能，该功能可以将快照保存为检查点的一部分</text></g></g><g id="minder_node145"><g id="node_expander182" style="cursor: pointer;"><path id="kity_path_1661" fill="white" stroke="gray" d="M523.5,6311.5A6,6,0,1,1,511.5,6311.5A6,6,0,1,1,523.5,6311.5"></path><path id="kity_path_1662" fill="none" stroke="gray" d="M513,6311.5L522,6311.5"></path></g><path id="node_outline183" fill="none" stroke="none" d="M528.5,6300.5h190a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-190a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text183" fill="black"><text id="kity_text_842" text-rendering="inherit" font-size="12" dy=".8em" y="6305.5" x="533.5">种类（后续有时间详细扩展描述）</text></g></g><g id="minder_node146"><g id="node_expander155" style="cursor: pointer;"><path id="kity_path_1580" fill="white" stroke="gray" d="M763.5,5849.5A6,6,0,1,1,751.5,5849.5A6,6,0,1,1,763.5,5849.5"></path><path id="kity_path_1581" fill="none" stroke="gray" d="M753,5849.5L762,5849.5"></path></g><path id="node_outline156" fill="none" stroke="none" d="M768.5,5820.5h188a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-188a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text156" fill="black"><text id="kity_text_778" text-rendering="inherit" font-size="12" dy=".8em" y="5825.5" x="773.5">MemoryStateBackend（默认）</text><text id="kity_text_779" text-rendering="inherit" font-size="12" dy=".8em" y="5843.5" x="773.5"></text><text id="kity_text_780" text-rendering="inherit" font-size="12" dy=".8em" y="5861.5" x="773.5">-较小</text></g></g><g id="minder_node147"><g id="node_expander147" style="cursor: pointer;"><path id="kity_path_1556" fill="white" stroke="gray" d="M1001.5,5680.5A6,6,0,1,1,989.5,5680.5A6,6,0,1,1,1001.5,5680.5"></path><path id="kity_path_1557" fill="none" stroke="gray" d="M991,5680.5L1000,5680.5"></path></g><path id="node_outline148" fill="none" stroke="none" d="M1006.5,5669.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text148" fill="black"><text id="kity_text_761" text-rendering="inherit" font-size="12" dy=".8em" y="5674.5" x="1011.5">描述</text></g></g><g id="minder_node148"><g id="node_expander143" display="none" style="cursor: pointer;"><path id="kity_path_1544" fill="white" stroke="gray" d="M1085.5,5593.5A6,6,0,1,1,1073.5,5593.5A6,6,0,1,1,1085.5,5593.5"></path><path id="kity_path_1545" fill="none" stroke="gray"></path></g><path id="node_outline144" fill="none" stroke="none" d="M1090.5,5582.5h263a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-263a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text144" fill="black"><text id="kity_text_752" text-rendering="inherit" font-size="12" dy=".8em" y="5587.5" x="1095.5">内部状态backend ，用于维护Java堆上的状态</text></g></g><g id="minder_node149"><g id="node_expander144" display="none" style="cursor: pointer;"><path id="kity_path_1547" fill="white" stroke="gray" d="M1085.5,5645.5A6,6,0,1,1,1073.5,5645.5A6,6,0,1,1,1085.5,5645.5"></path><path id="kity_path_1548" fill="none" stroke="gray"></path></g><path id="node_outline145" fill="none" stroke="none" d="M1090.5,5634.5h361a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-361a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text145" fill="black"><text id="kity_text_754" text-rendering="inherit" font-size="12" dy=".8em" y="5639.5" x="1095.5">&#xa0;Key/value 状态和window算子包含存储值和计时器等的的哈希表</text></g></g><g id="minder_node150"><g id="node_expander145" display="none" style="cursor: pointer;"><path id="kity_path_1550" fill="white" stroke="gray" d="M1085.5,5697.5A6,6,0,1,1,1073.5,5697.5A6,6,0,1,1,1085.5,5697.5"></path><path id="kity_path_1551" fill="none" stroke="gray"></path></g><path id="node_outline146" fill="none" stroke="none" d="M1090.5,5686.5h829a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-829a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text146" fill="black"><text id="kity_text_756" text-rendering="inherit" font-size="12" dy=".8em" y="5691.5" x="1095.5">在检查点时，此state backend将对state进行SNAPSHOT，并将其作为检查点确认消息的一部分发送到JobManager，JobManager也将其存储在其堆上</text></g></g><g id="minder_node151"><g id="node_expander146" display="none" style="cursor: pointer;"><path id="kity_path_1553" fill="white" stroke="gray" d="M1085.5,5758.5A6,6,0,1,1,1073.5,5758.5A6,6,0,1,1,1085.5,5758.5"></path><path id="kity_path_1554" fill="none" stroke="gray"></path></g><path id="node_outline147" fill="none" stroke="none" d="M1090.5,5738.5h647a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-647a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text147" fill="black"><text id="kity_text_758" text-rendering="inherit" font-size="12" dy=".8em" y="5743.5" x="1095.5">默认情况下，MemoryStateBackend配置为支持异步快照。 异步快照可避免可能导致流应用程序背压的潜在阻塞管道。</text><text id="kity_text_759" text-rendering="inherit" font-size="12" dy=".8em" y="5761.5" x="1095.5">（调试时可以关闭new MemoryStateBackend(MAX_MEM_STATE_SIZE, false);）</text></g></g><g id="minder_node152"><g id="node_expander151" style="cursor: pointer;"><path id="kity_path_1568" fill="white" stroke="gray" d="M1001.5,5880.5A6,6,0,1,1,989.5,5880.5A6,6,0,1,1,1001.5,5880.5"></path><path id="kity_path_1569" fill="none" stroke="gray" d="M991,5880.5L1000,5880.5"></path></g><path id="node_outline152" fill="none" stroke="none" d="M1006.5,5869.5h46a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-46a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text152" fill="black"><text id="kity_text_770" text-rendering="inherit" font-size="12" dy=".8em" y="5874.5" x="1011.5">局限性</text></g></g><g id="minder_node153"><g id="node_expander148" display="none" style="cursor: pointer;"><path id="kity_path_1559" fill="white" stroke="gray" d="M1097.5,5828.5A6,6,0,1,1,1085.5,5828.5A6,6,0,1,1,1097.5,5828.5"></path><path id="kity_path_1560" fill="none" stroke="gray"></path></g><path id="node_outline149" fill="none" stroke="none" d="M1102.5,5808.5h308a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-308a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text149" fill="black"><text id="kity_text_763" text-rendering="inherit" font-size="12" dy=".8em" y="5813.5" x="1107.5">默认情况下，每个状态的大小限制为5 MB。</text><text id="kity_text_764" text-rendering="inherit" font-size="12" dy=".8em" y="5831.5" x="1107.5">可以在MemoryStateBackend的构造函数中增加此值。</text></g></g><g id="minder_node154"><g id="node_expander149" display="none" style="cursor: pointer;"><path id="kity_path_1562" fill="white" stroke="gray" d="M1097.5,5889.5A6,6,0,1,1,1085.5,5889.5A6,6,0,1,1,1097.5,5889.5"></path><path id="kity_path_1563" fill="none" stroke="gray"></path></g><path id="node_outline150" fill="none" stroke="none" d="M1102.5,5878.5h326a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-326a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text150" fill="black"><text id="kity_text_766" text-rendering="inherit" font-size="12" dy=".8em" y="5883.5" x="1107.5">无论配置的最大状态大小如何，状态都不能大于akka帧大小</text></g></g><g id="minder_node155"><g id="node_expander150" display="none" style="cursor: pointer;"><path id="kity_path_1565" fill="white" stroke="gray" d="M1097.5,5941.5A6,6,0,1,1,1085.5,5941.5A6,6,0,1,1,1097.5,5941.5"></path><path id="kity_path_1566" fill="none" stroke="gray"></path></g><path id="node_outline151" fill="none" stroke="none" d="M1102.5,5930.5h206a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-206a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text151" fill="black"><text id="kity_text_768" text-rendering="inherit" font-size="12" dy=".8em" y="5935.5" x="1107.5">聚合状态必须适合JobManager内存</text></g></g><g id="minder_node156"><g id="node_expander154" style="cursor: pointer;"><path id="kity_path_1577" fill="white" stroke="gray" d="M1001.5,6019.5A6,6,0,1,1,989.5,6019.5A6,6,0,1,1,1001.5,6019.5"></path><path id="kity_path_1578" fill="none" stroke="gray" d="M991,6019.5L1000,6019.5"></path></g><path id="node_outline155" fill="none" stroke="none" d="M1006.5,6008.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text155" fill="black"><text id="kity_text_776" text-rendering="inherit" font-size="12" dy=".8em" y="6013.5" x="1011.5">应用场景</text></g></g><g id="minder_node157"><g id="node_expander152" display="none" style="cursor: pointer;"><path id="kity_path_1571" fill="white" stroke="gray" d="M1109.5,5993.5A6,6,0,1,1,1097.5,5993.5A6,6,0,1,1,1109.5,5993.5"></path><path id="kity_path_1572" fill="none" stroke="gray"></path></g><path id="node_outline153" fill="none" stroke="none" d="M1114.5,5982.5h202a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-202a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text153" fill="black"><text id="kity_text_772" text-rendering="inherit" font-size="12" dy=".8em" y="5987.5" x="1119.5">本地开发和调试，因为它的状态有限</text></g></g><g id="minder_node158"><g id="node_expander153" display="none" style="cursor: pointer;"><path id="kity_path_1574" fill="white" stroke="gray" d="M1109.5,6045.5A6,6,0,1,1,1097.5,6045.5A6,6,0,1,1,1109.5,6045.5"></path><path id="kity_path_1575" fill="none" stroke="gray"></path></g><path id="node_outline154" fill="none" stroke="none" d="M1114.5,6034.5h562a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-562a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text154" fill="black"><text id="kity_text_774" text-rendering="inherit" font-size="12" dy=".8em" y="6039.5" x="1119.5">适合很少状态的作业，如仅包含一次记录功能（Map，FlatMap或Filter）的作业或使用Kafkaconsumer</text></g></g><g id="minder_node159"><g id="node_expander165" style="cursor: pointer;"><path id="kity_path_1610" fill="white" stroke="gray" d="M763.5,6291.5A6,6,0,1,1,751.5,6291.5A6,6,0,1,1,763.5,6291.5"></path><path id="kity_path_1611" fill="none" stroke="gray" d="M753,6291.5L762,6291.5"></path></g><path id="node_outline166" fill="none" stroke="none" d="M768.5,6262.5h103a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-103a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text166" fill="black"><text id="kity_text_800" text-rendering="inherit" font-size="12" dy=".8em" y="6267.5" x="773.5">FsStateBackend</text><text id="kity_text_801" text-rendering="inherit" font-size="12" dy=".8em" y="6285.5" x="773.5"></text><text id="kity_text_802" text-rendering="inherit" font-size="12" dy=".8em" y="6303.5" x="773.5">-大</text></g></g><g id="minder_node160"><g id="node_expander161" style="cursor: pointer;"><path id="kity_path_1598" fill="white" stroke="gray" d="M916.5,6200.5A6,6,0,1,1,904.5,6200.5A6,6,0,1,1,916.5,6200.5"></path><path id="kity_path_1599" fill="none" stroke="gray" d="M906,6200.5L915,6200.5"></path></g><path id="node_outline162" fill="none" stroke="none" d="M921.5,6189.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text162" fill="black"><text id="kity_text_792" text-rendering="inherit" font-size="12" dy=".8em" y="6194.5" x="926.5">描述</text></g></g><g id="minder_node161"><g id="node_expander156" display="none" style="cursor: pointer;"><path id="kity_path_1583" fill="white" stroke="gray" d="M1000.5,6096.5A6,6,0,1,1,988.5,6096.5A6,6,0,1,1,1000.5,6096.5"></path><path id="kity_path_1584" fill="none" stroke="gray"></path></g><path id="node_outline157" fill="none" stroke="none" d="M1005.5,6085.5h82a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-82a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text157" fill="black"><text id="kity_text_782" text-rendering="inherit" font-size="12" dy=".8em" y="6090.5" x="1010.5">基于文件系统</text></g></g><g id="minder_node162"><g id="node_expander157" display="none" style="cursor: pointer;"><path id="kity_path_1586" fill="white" stroke="gray" d="M1000.5,6148.5A6,6,0,1,1,988.5,6148.5A6,6,0,1,1,1000.5,6148.5"></path><path id="kity_path_1587" fill="none" stroke="gray"></path></g><path id="node_outline158" fill="none" stroke="none" d="M1005.5,6137.5h268a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-268a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text158" fill="black"><text id="kity_text_784" text-rendering="inherit" font-size="12" dy=".8em" y="6142.5" x="1010.5">将正在运行的数据保存在TaskManager的内存中</text></g></g><g id="minder_node163"><g id="node_expander158" display="none" style="cursor: pointer;"><path id="kity_path_1589" fill="white" stroke="gray" d="M1000.5,6200.5A6,6,0,1,1,988.5,6200.5A6,6,0,1,1,1000.5,6200.5"></path><path id="kity_path_1590" fill="none" stroke="gray"></path></g><path id="node_outline159" fill="none" stroke="none" d="M1005.5,6189.5h359a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-359a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text159" fill="black"><text id="kity_text_786" text-rendering="inherit" font-size="12" dy=".8em" y="6194.5" x="1010.5">在检查点时，它将状态SNAPSHOT写入配置的文件系统和目录中。</text></g></g><g id="minder_node164"><g id="node_expander159" display="none" style="cursor: pointer;"><path id="kity_path_1592" fill="white" stroke="gray" d="M1000.5,6252.5A6,6,0,1,1,988.5,6252.5A6,6,0,1,1,1000.5,6252.5"></path><path id="kity_path_1593" fill="none" stroke="gray"></path></g><path id="node_outline160" fill="none" stroke="none" d="M1005.5,6241.5h752a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-752a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text160" fill="black"><text id="kity_text_788" text-rendering="inherit" font-size="12" dy=".8em" y="6246.5" x="1010.5">最小元数据（&#xa0;Minimal metadata）存储在JobManager的内存中（或者，在高可用性模式下，存储在元数据检查点中（Zookeeper））。</text></g></g><g id="minder_node165"><g id="node_expander160" display="none" style="cursor: pointer;"><path id="kity_path_1595" fill="white" stroke="gray" d="M1000.5,6304.5A6,6,0,1,1,988.5,6304.5A6,6,0,1,1,1000.5,6304.5"></path><path id="kity_path_1596" fill="none" stroke="gray"></path></g><path id="node_outline161" fill="none" stroke="none" d="M1005.5,6293.5h792a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-792a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text161" fill="black"><text id="kity_text_790" text-rendering="inherit" font-size="12" dy=".8em" y="6298.5" x="1010.5">FsStateBackend&#xa0;默认使用异步SNAPSHOT，以避免在编写状态检查点时阻塞处理管道。（禁用的话可以使用new FsStateBackend(path, false);）</text></g></g><g id="minder_node166"><g id="node_expander164" style="cursor: pointer;"><path id="kity_path_1607" fill="white" stroke="gray" d="M916.5,6382.5A6,6,0,1,1,904.5,6382.5A6,6,0,1,1,916.5,6382.5"></path><path id="kity_path_1608" fill="none" stroke="gray" d="M906,6382.5L915,6382.5"></path></g><path id="node_outline165" fill="none" stroke="none" d="M921.5,6371.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text165" fill="black"><text id="kity_text_798" text-rendering="inherit" font-size="12" dy=".8em" y="6376.5" x="926.5">使用场景</text></g></g><g id="minder_node167"><g id="node_expander162" display="none" style="cursor: pointer;"><path id="kity_path_1601" fill="white" stroke="gray" d="M1024.5,6356.5A6,6,0,1,1,1012.5,6356.5A6,6,0,1,1,1024.5,6356.5"></path><path id="kity_path_1602" fill="none" stroke="gray"></path></g><path id="node_outline163" fill="none" stroke="none" d="M1029.5,6345.5h351a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-351a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text163" fill="black"><text id="kity_text_794" text-rendering="inherit" font-size="12" dy=".8em" y="6350.5" x="1034.5">Jobs with large state, long windows, large key/value states.</text></g></g><g id="minder_node168"><g id="node_expander163" display="none" style="cursor: pointer;"><path id="kity_path_1604" fill="white" stroke="gray" d="M1024.5,6408.5A6,6,0,1,1,1012.5,6408.5A6,6,0,1,1,1024.5,6408.5"></path><path id="kity_path_1605" fill="none" stroke="gray"></path></g><path id="node_outline164" fill="none" stroke="none" d="M1029.5,6397.5h269a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-269a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text164" fill="black"><text id="kity_text_796" text-rendering="inherit" font-size="12" dy=".8em" y="6402.5" x="1034.5">所有高可用性设置。All high-availability setups.</text></g></g><g id="minder_node169"><g id="node_expander181" style="cursor: pointer;"><path id="kity_path_1658" fill="white" stroke="gray" d="M763.5,6773.5A6,6,0,1,1,751.5,6773.5A6,6,0,1,1,763.5,6773.5"></path><path id="kity_path_1659" fill="none" stroke="gray" d="M753,6773.5L762,6773.5"></path></g><path id="node_outline182" fill="none" stroke="none" d="M768.5,6744.5h142a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-142a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text182" fill="black"><text id="kity_text_838" text-rendering="inherit" font-size="12" dy=".8em" y="6749.5" x="773.5">RocksDBStateBackend</text><text id="kity_text_839" text-rendering="inherit" font-size="12" dy=".8em" y="6767.5" x="773.5"></text><text id="kity_text_840" text-rendering="inherit" font-size="12" dy=".8em" y="6785.5" x="773.5">-超大</text></g></g><g id="minder_node170"><g id="node_expander171" style="cursor: pointer;"><path id="kity_path_1628" fill="white" stroke="gray" d="M955.5,6564.5A6,6,0,1,1,943.5,6564.5A6,6,0,1,1,955.5,6564.5"></path><path id="kity_path_1629" fill="none" stroke="gray" d="M945,6564.5L954,6564.5"></path></g><path id="node_outline172" fill="none" stroke="none" d="M960.5,6553.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text172" fill="black"><text id="kity_text_814" text-rendering="inherit" font-size="12" dy=".8em" y="6558.5" x="965.5">描述</text></g></g><g id="minder_node171"><g id="node_expander166" display="none" style="cursor: pointer;"><path id="kity_path_1613" fill="white" stroke="gray" d="M1039.5,6460.5A6,6,0,1,1,1027.5,6460.5A6,6,0,1,1,1039.5,6460.5"></path><path id="kity_path_1614" fill="none" stroke="gray"></path></g><path id="node_outline167" fill="none" stroke="none" d="M1044.5,6449.5h82a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-82a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text167" fill="black"><text id="kity_text_804" text-rendering="inherit" font-size="12" dy=".8em" y="6454.5" x="1049.5">基于文件系统</text></g></g><g id="minder_node172"><g id="node_expander167" display="none" style="cursor: pointer;"><path id="kity_path_1616" fill="white" stroke="gray" d="M1039.5,6512.5A6,6,0,1,1,1027.5,6512.5A6,6,0,1,1,1039.5,6512.5"></path><path id="kity_path_1617" fill="none" stroke="gray"></path></g><path id="node_outline168" fill="none" stroke="none" d="M1044.5,6501.5h354a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-354a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text168" fill="black"><text id="kity_text_806" text-rendering="inherit" font-size="12" dy=".8em" y="6506.5" x="1049.5">将RocksDB中正在运行的数据保存在TaskManager数据目录中。</text></g></g><g id="minder_node173"><g id="node_expander168" display="none" style="cursor: pointer;"><path id="kity_path_1619" fill="white" stroke="gray" d="M1039.5,6564.5A6,6,0,1,1,1027.5,6564.5A6,6,0,1,1,1039.5,6564.5"></path><path id="kity_path_1620" fill="none" stroke="gray"></path></g><path id="node_outline169" fill="none" stroke="none" d="M1044.5,6553.5h454a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-454a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text169" fill="black"><text id="kity_text_808" text-rendering="inherit" font-size="12" dy=".8em" y="6558.5" x="1049.5">在检查点时，整个RocksDB数据库将被checkpointed到配置的文件系统和目录中。</text></g></g><g id="minder_node174"><g id="node_expander169" display="none" style="cursor: pointer;"><path id="kity_path_1622" fill="white" stroke="gray" d="M1039.5,6616.5A6,6,0,1,1,1027.5,6616.5A6,6,0,1,1,1039.5,6616.5"></path><path id="kity_path_1623" fill="none" stroke="gray"></path></g><path id="node_outline170" fill="none" stroke="none" d="M1044.5,6605.5h617a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-617a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text170" fill="black"><text id="kity_text_810" text-rendering="inherit" font-size="12" dy=".8em" y="6610.5" x="1049.5">最小元数据存储在JobManager的内存中（或者，在高可用性模式下，存储在元数据检查点中（Zookeeper））。</text></g></g><g id="minder_node175"><g id="node_expander170" display="none" style="cursor: pointer;"><path id="kity_path_1625" fill="white" stroke="gray" d="M1039.5,6668.5A6,6,0,1,1,1027.5,6668.5A6,6,0,1,1,1039.5,6668.5"></path><path id="kity_path_1626" fill="none" stroke="gray"></path></g><path id="node_outline171" fill="none" stroke="none" d="M1044.5,6657.5h286a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-286a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text171" fill="black"><text id="kity_text_812" text-rendering="inherit" font-size="12" dy=".8em" y="6662.5" x="1049.5">RocksDBStateBackend始终执行异步SNAPSHOT。</text></g></g><g id="minder_node176"><g id="node_expander173" style="cursor: pointer;"><path id="kity_path_1634" fill="white" stroke="gray" d="M955.5,6738.5A6,6,0,1,1,943.5,6738.5A6,6,0,1,1,955.5,6738.5"></path><path id="kity_path_1635" fill="none" stroke="gray" d="M945,6738.5L954,6738.5"></path></g><path id="node_outline174" fill="none" stroke="none" d="M960.5,6727.5h46a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-46a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text174" fill="black"><text id="kity_text_820" text-rendering="inherit" font-size="12" dy=".8em" y="6732.5" x="965.5">局限性</text></g></g><g id="minder_node177"><g id="node_expander172" display="none" style="cursor: pointer;"><path id="kity_path_1631" fill="white" stroke="gray" d="M1051.5,6738.5A6,6,0,1,1,1039.5,6738.5A6,6,0,1,1,1051.5,6738.5"></path><path id="kity_path_1632" fill="none" stroke="gray"></path></g><path id="node_outline173" fill="none" stroke="none" d="M1056.5,6709.5h717a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-717a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text173" fill="black"><text id="kity_text_816" text-rendering="inherit" font-size="12" dy=".8em" y="6714.5" x="1061.5">由于RocksDB的JNI桥接API基于byte []，因此每个Keys和每个值的最大支持大小为2 ^ 31个字节。</text><text id="kity_text_817" text-rendering="inherit" font-size="12" dy=".8em" y="6732.5" x="1061.5">重要提示：在RocksDB中使用合并 算子操作的状态（例如ListState）可以静默地累积&gt; 2 ^ 31字节的值大小，然后在下次检索时失败。</text><text id="kity_text_818" text-rendering="inherit" font-size="12" dy=".8em" y="6750.5" x="1061.5">这是目前RocksDB JNI的一个限制。</text></g></g><g id="minder_node178"><g id="node_expander176" style="cursor: pointer;"><path id="kity_path_1643" fill="white" stroke="gray" d="M955.5,6834.5A6,6,0,1,1,943.5,6834.5A6,6,0,1,1,955.5,6834.5"></path><path id="kity_path_1644" fill="none" stroke="gray" d="M945,6834.5L954,6834.5"></path></g><path id="node_outline177" fill="none" stroke="none" d="M960.5,6823.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text177" fill="black"><text id="kity_text_826" text-rendering="inherit" font-size="12" dy=".8em" y="6828.5" x="965.5">使用场景</text></g></g><g id="minder_node179"><g id="node_expander174" display="none" style="cursor: pointer;"><path id="kity_path_1637" fill="white" stroke="gray" d="M1063.5,6808.5A6,6,0,1,1,1051.5,6808.5A6,6,0,1,1,1063.5,6808.5"></path><path id="kity_path_1638" fill="none" stroke="gray"></path></g><path id="node_outline175" fill="none" stroke="none" d="M1068.5,6797.5h378a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-378a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text175" fill="black"><text id="kity_text_822" text-rendering="inherit" font-size="12" dy=".8em" y="6802.5" x="1073.5">Jobs with very large state, long windows, large key/value states.</text></g></g><g id="minder_node180"><g id="node_expander175" display="none" style="cursor: pointer;"><path id="kity_path_1640" fill="white" stroke="gray" d="M1063.5,6860.5A6,6,0,1,1,1051.5,6860.5A6,6,0,1,1,1063.5,6860.5"></path><path id="kity_path_1641" fill="none" stroke="gray"></path></g><path id="node_outline176" fill="none" stroke="none" d="M1068.5,6849.5h269a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-269a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text176" fill="black"><text id="kity_text_824" text-rendering="inherit" font-size="12" dy=".8em" y="6854.5" x="1073.5">所有高可用性设置。All high-availability setups.</text></g></g><g id="minder_node181"><g id="node_expander180" style="cursor: pointer;"><path id="kity_path_1655" fill="white" stroke="gray" d="M955.5,6982.5A6,6,0,1,1,943.5,6982.5A6,6,0,1,1,955.5,6982.5"></path><path id="kity_path_1656" fill="none" stroke="gray" d="M945,6982.5L954,6982.5"></path></g><path id="node_outline181" fill="none" stroke="none" d="M960.5,6971.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text181" fill="black"><text id="kity_text_836" text-rendering="inherit" font-size="12" dy=".8em" y="6976.5" x="965.5">特点</text></g></g><g id="minder_node182"><g id="node_expander177" display="none" style="cursor: pointer;"><path id="kity_path_1646" fill="white" stroke="gray" d="M1039.5,6912.5A6,6,0,1,1,1027.5,6912.5A6,6,0,1,1,1039.5,6912.5"></path><path id="kity_path_1647" fill="none" stroke="gray"></path></g><path id="node_outline178" fill="none" stroke="none" d="M1044.5,6901.5h638a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-638a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text178" fill="black"><text id="kity_text_828" text-rendering="inherit" font-size="12" dy=".8em" y="6906.5" x="1049.5">使用RocksDB时，状态大小仅受可用磁盘空间量的限制，这使RocksDBStateBackend成为管理超大状态的绝佳选择。&#xa0;</text></g></g><g id="minder_node183"><g id="node_expander178" display="none" style="cursor: pointer;"><path id="kity_path_1649" fill="white" stroke="gray" d="M1039.5,6982.5A6,6,0,1,1,1027.5,6982.5A6,6,0,1,1,1039.5,6982.5"></path><path id="kity_path_1650" fill="none" stroke="gray"></path></g><path id="node_outline179" fill="none" stroke="none" d="M1044.5,6953.5h768a5,5,0,0,1,5,5v48a5,5,0,0,1,-5,5h-768a5,5,0,0,1,-5,-5v-48a5,5,0,0,1,5,-5z"></path><g id="node_text179" fill="black"><text id="kity_text_830" text-rendering="inherit" font-size="12" dy=".8em" y="6958.5" x="1049.5">使用RocksDB时的权衡是所有状态访问和检索都需要序列化（或反序列化）才能跨越JNI边界。</text><text id="kity_text_831" text-rendering="inherit" font-size="12" dy=".8em" y="6976.5" x="1049.5">即所有读/写都必须通过去/序列化来检索/存储状态对象，&#xa0;与上面提到的 on-heap（内存） backends相比，这可能会影响应用程序的吞吐量。</text><text id="kity_text_832" text-rendering="inherit" font-size="12" dy=".8em" y="6994.5" x="1049.5">（&#xa0;All reads/writes from/to this backend have to go through de-/serialization to retrieve/store the state objects）</text></g></g><g id="minder_node184"><g id="node_expander179" display="none" style="cursor: pointer;"><path id="kity_path_1652" fill="white" stroke="gray" d="M1039.5,7052.5A6,6,0,1,1,1027.5,7052.5A6,6,0,1,1,1039.5,7052.5"></path><path id="kity_path_1653" fill="none" stroke="gray"></path></g><path id="node_outline180" fill="none" stroke="none" d="M1044.5,7041.5h351a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-351a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text180" fill="black"><text id="kity_text_834" text-rendering="inherit" font-size="12" dy=".8em" y="7046.5" x="1049.5">RocksDBStateBackend是目前唯一提供增量检查点的backend</text></g></g><g id="minder_node185"><g id="node_expander189" style="cursor: pointer;"><path id="kity_path_1682" fill="white" stroke="gray" d="M523.5,7186.5A6,6,0,1,1,511.5,7186.5A6,6,0,1,1,523.5,7186.5"></path><path id="kity_path_1683" fill="none" stroke="gray" d="M513,7186.5L522,7186.5"></path></g><path id="node_outline190" fill="none" stroke="none" d="M528.5,7175.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text190" fill="black"><text id="kity_text_857" text-rendering="inherit" font-size="12" dy=".8em" y="7180.5" x="533.5">配置</text></g></g><g id="minder_node186"><g id="node_expander185" style="cursor: pointer;"><path id="kity_path_1670" fill="white" stroke="gray" d="M607.5,7130.5A6,6,0,1,1,595.5,7130.5A6,6,0,1,1,607.5,7130.5"></path><path id="kity_path_1671" fill="none" stroke="gray" d="M597,7130.5L606,7130.5"></path></g><path id="node_outline186" fill="none" stroke="none" d="M612.5,7119.5h82a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-82a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text186" fill="black"><text id="kity_text_848" text-rendering="inherit" font-size="12" dy=".8em" y="7124.5" x="617.5">默认全局配置</text></g></g><g id="minder_node187"><g id="node_expander183" display="none" style="cursor: pointer;"><path id="kity_path_1664" fill="white" stroke="gray" d="M739.5,7104.5A6,6,0,1,1,727.5,7104.5A6,6,0,1,1,739.5,7104.5"></path><path id="kity_path_1665" fill="none" stroke="gray"></path></g><path id="node_outline184" fill="none" stroke="none" d="M744.5,7093.5h370a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-370a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text184" fill="black"><text id="kity_text_844" text-rendering="inherit" font-size="12" dy=".8em" y="7098.5" x="749.5">默认情况下，配置文件flink-conf.yaml确定所有Flink作业的状态后台</text></g></g><g id="minder_node188"><g id="node_expander184" display="none" style="cursor: pointer;"><path id="kity_path_1667" fill="white" stroke="gray" d="M739.5,7156.5A6,6,0,1,1,727.5,7156.5A6,6,0,1,1,739.5,7156.5"></path><path id="kity_path_1668" fill="none" stroke="gray"></path></g><path id="node_outline185" fill="none" stroke="none" d="M744.5,7145.5h228a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-228a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text185" fill="black"><text id="kity_text_846" text-rendering="inherit" font-size="12" dy=".8em" y="7150.5" x="749.5">state.backend、state.checkpoints.dir</text></g></g><g id="minder_node189"><g id="node_expander188" style="cursor: pointer;"><path id="kity_path_1679" fill="white" stroke="gray" d="M607.5,7243.5A6,6,0,1,1,595.5,7243.5A6,6,0,1,1,607.5,7243.5"></path><path id="kity_path_1680" fill="none" stroke="gray" d="M597,7243.5L606,7243.5"></path></g><path id="node_outline189" fill="none" stroke="none" d="M612.5,7232.5h112a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-112a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text189" fill="black"><text id="kity_text_855" text-rendering="inherit" font-size="12" dy=".8em" y="7237.5" x="617.5">对每个job单独配置</text></g></g><g id="minder_node190"><g id="node_expander186" display="none" style="cursor: pointer;"><path id="kity_path_1673" fill="white" stroke="gray" d="M769.5,7208.5A6,6,0,1,1,757.5,7208.5A6,6,0,1,1,769.5,7208.5"></path><path id="kity_path_1674" fill="none" stroke="gray"></path></g><path id="node_outline187" fill="none" stroke="none" d="M774.5,7197.5h282a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-282a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text187" fill="black"><text id="kity_text_850" text-rendering="inherit" font-size="12" dy=".8em" y="7202.5" x="779.5">针对此job的StreamExecutionEnvironment来配置</text></g></g><g id="minder_node191"><g id="node_expander187" display="none" style="cursor: pointer;"><path id="kity_path_1676" fill="white" stroke="gray" d="M769.5,7269.5A6,6,0,1,1,757.5,7269.5A6,6,0,1,1,769.5,7269.5"></path><path id="kity_path_1677" fill="none" stroke="gray"></path></g><path id="node_outline188" fill="none" stroke="none" d="M774.5,7249.5h524a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-524a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text188" fill="#ff0000"><text id="kity_text_852" text-rendering="inherit" font-size="12" dy=".8em" y="7254.5" x="779.5">val env = StreamExecutionEnvironment.getExecutionEnvironment()</text><text id="kity_text_853" text-rendering="inherit" font-size="12" dy=".8em" y="7272.5" x="779.5">env.setStateBackend(new FsStateBackend("hdfs://namenode:40010/flink/checkpoints"))</text></g></g><g id="minder_node192"><g id="node_expander202" style="cursor: pointer;"><path id="kity_path_1721" fill="white" stroke="gray" d="M337.5,7463.5A6,6,0,1,1,325.5,7463.5A6,6,0,1,1,337.5,7463.5"></path><path id="kity_path_1722" fill="none" stroke="gray" d="M327,7463.5L336,7463.5"></path></g><path id="node_outline203" fill="rgb(238, 243, 246)" stroke="rgb(115, 161, 191)" d="M341.5,7450.5h150a3,3,0,0,1,3,3v20a3,3,0,0,1,-3,3h-150a3,3,0,0,1,-3,-3v-20a3,3,0,0,1,3,-3z" stroke-width="1"></path><g id="node_text203" fill="black"><text id="kity_text_885" text-rendering="inherit" font-size="14" dy=".8em" y="7456.5" x="358.5">Savepoints保存点</text></g></g><g id="minder_node193"><g id="node_expander193" style="cursor: pointer;"><path id="kity_path_1694" fill="white" stroke="gray" d="M534.5,7365.5A6,6,0,1,1,522.5,7365.5A6,6,0,1,1,534.5,7365.5"></path><path id="kity_path_1695" fill="none" stroke="gray" d="M524,7365.5L533,7365.5"></path></g><path id="node_outline194" fill="none" stroke="none" d="M539.5,7354.5h34a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-34a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text194" fill="black"><text id="kity_text_865" text-rendering="inherit" font-size="12" dy=".8em" y="7359.5" x="544.5">概念</text></g></g><g id="minder_node194"><g id="node_expander191" display="none" style="cursor: pointer;"><path id="kity_path_1688" fill="white" stroke="gray" d="M618.5,7339.5A6,6,0,1,1,606.5,7339.5A6,6,0,1,1,618.5,7339.5"></path><path id="kity_path_1689" fill="none" stroke="gray"></path></g><path id="node_outline192" fill="none" stroke="none" d="M623.5,7328.5h633a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-633a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text192" fill="black"><text id="kity_text_861" text-rendering="inherit" font-size="12" dy=".8em" y="7333.5" x="628.5">使用Data Stream API的程序可以从指定的保存点恢复。保存点可以更新程序和Flink集群，并且不丢失任何状态的功能</text></g></g><g id="minder_node195"><g id="node_expander192" display="none" style="cursor: pointer;"><path id="kity_path_1691" fill="white" stroke="gray" d="M618.5,7391.5A6,6,0,1,1,606.5,7391.5A6,6,0,1,1,618.5,7391.5"></path><path id="kity_path_1692" fill="none" stroke="gray"></path></g><path id="node_outline193" fill="none" stroke="none" d="M623.5,7380.5h694a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-694a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text193" fill="black"><text id="kity_text_863" text-rendering="inherit" font-size="12" dy=".8em" y="7385.5" x="628.5">savepoint是手动触发的checkpoint，它会获取程序的SNAPSHOT并将其写入state backend。他们依靠常规的checkpoint机制</text></g></g><g id="minder_node196"><g id="node_expander201" style="cursor: pointer;"><path id="kity_path_1718" fill="white" stroke="gray" d="M534.5,7561.5A6,6,0,1,1,522.5,7561.5A6,6,0,1,1,534.5,7561.5"></path><path id="kity_path_1719" fill="none" stroke="gray" d="M524,7561.5L533,7561.5"></path></g><path id="node_outline202" fill="none" stroke="none" d="M539.5,7550.5h125a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-125a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text202" fill="black"><text id="kity_text_883" text-rendering="inherit" font-size="12" dy=".8em" y="7555.5" x="544.5">与checkpoint的比较</text></g></g><g id="minder_node197"><g id="node_expander194" display="none" style="cursor: pointer;"><path id="kity_path_1697" fill="white" stroke="gray" d="M709.5,7444.5A6,6,0,1,1,697.5,7444.5A6,6,0,1,1,709.5,7444.5"></path><path id="kity_path_1698" fill="none" stroke="gray"></path></g><path id="node_outline195" fill="none" stroke="none" d="M714.5,7433.5h464a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-464a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text195" fill="black"><text id="kity_text_867" text-rendering="inherit" font-size="12" dy=".8em" y="7438.5" x="719.5">相对于checkpoint来比较，checkpoint是针对于内部的，savepoint是针对于外部的</text></g></g><g id="minder_node198"><g id="node_expander195" display="none" style="cursor: pointer;"><path id="kity_path_1700" fill="white" stroke="gray" d="M709.5,7496.5A6,6,0,1,1,697.5,7496.5A6,6,0,1,1,709.5,7496.5"></path><path id="kity_path_1701" fill="none" stroke="gray"></path></g><path id="node_outline196" fill="none" stroke="none" d="M714.5,7485.5h194a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-194a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text196" fill="black"><text id="kity_text_869" text-rendering="inherit" font-size="12" dy=".8em" y="7490.5" x="719.5">checkpoint自动，savepoint手动</text></g></g><g id="minder_node199"><g id="node_expander198" style="cursor: pointer;"><path id="kity_path_1709" fill="white" stroke="gray" d="M709.5,7583.5A6,6,0,1,1,697.5,7583.5A6,6,0,1,1,709.5,7583.5"></path><path id="kity_path_1710" fill="none" stroke="gray" d="M699,7583.5L708,7583.5"></path></g><path id="node_outline199" fill="none" stroke="none" d="M714.5,7572.5h58a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-58a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text199" fill="black"><text id="kity_text_876" text-rendering="inherit" font-size="12" dy=".8em" y="7577.5" x="719.5">失效问题</text></g></g><g id="minder_node200"><g id="node_expander196" display="none" style="cursor: pointer;"><path id="kity_path_1703" fill="white" stroke="gray" d="M817.5,7557.5A6,6,0,1,1,805.5,7557.5A6,6,0,1,1,817.5,7557.5"></path><path id="kity_path_1704" fill="none" stroke="gray"></path></g><path id="node_outline197" fill="none" stroke="none" d="M822.5,7537.5h689a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-689a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text197" fill="black"><text id="kity_text_871" text-rendering="inherit" font-size="12" dy=".8em" y="7542.5" x="827.5">程序执行时会定期在worker节点生成快照和checkpoint。</text><text id="kity_text_872" text-rendering="inherit" font-size="12" dy=".8em" y="7560.5" x="827.5">由于Flink的恢复机制只需要使用最新一个有效的checkpoint，在新的checkpoint生成后就可以安全移除其余旧的checkpoint了</text></g></g><g id="minder_node201"><g id="node_expander197" display="none" style="cursor: pointer;"><path id="kity_path_1706" fill="white" stroke="gray" d="M817.5,7618.5A6,6,0,1,1,805.5,7618.5A6,6,0,1,1,817.5,7618.5"></path><path id="kity_path_1707" fill="none" stroke="gray"></path></g><path id="node_outline198" fill="none" stroke="none" d="M822.5,7607.5h370a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-370a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text198" fill="black"><text id="kity_text_874" text-rendering="inherit" font-size="12" dy=".8em" y="7612.5" x="827.5">保存点是由用户触发的，并且在新的检查点生成后不会自动过期失效</text></g></g><g id="minder_node202"><g id="node_expander200" style="cursor: pointer;"><path id="kity_path_1715" fill="white" stroke="gray" d="M709.5,7679.5A6,6,0,1,1,697.5,7679.5A6,6,0,1,1,709.5,7679.5"></path><path id="kity_path_1716" fill="none" stroke="gray" d="M699,7679.5L708,7679.5"></path></g><path id="node_outline201" fill="none" stroke="none" d="M714.5,7668.5h113a5,5,0,0,1,5,5v12a5,5,0,0,1,-5,5h-113a5,5,0,0,1,-5,-5v-12a5,5,0,0,1,5,-5z"></path><g id="node_text201" fill="black"><text id="kity_text_881" text-rendering="inherit" font-size="12" dy=".8em" y="7673.5" x="719.5">举例，与spark比较</text></g></g><g id="minder_node203"><g id="node_expander199" display="none" style="cursor: pointer;"><path id="kity_path_1712" fill="white" stroke="gray" d="M872.5,7679.5A6,6,0,1,1,860.5,7679.5A6,6,0,1,1,872.5,7679.5"></path><path id="kity_path_1713" fill="none" stroke="gray"></path></g><path id="node_outline200" fill="none" stroke="none" d="M877.5,7659.5h782a5,5,0,0,1,5,5v30a5,5,0,0,1,-5,5h-782a5,5,0,0,1,-5,-5v-30a5,5,0,0,1,5,-5z"></path><g id="node_text200" fill="black"><text id="kity_text_878" text-rendering="inherit" font-size="12" dy=".8em" y="7664.5" x="882.5">SparkStreaming中，如果使用了checkpoint，流处理程序有更新的话，进行程序替换需要清理调checkpoint才能生效，</text><text id="kity_text_879" text-rendering="inherit" font-size="12" dy=".8em" y="7682.5" x="882.5">而在flink中，可以在流处理程序更新后，手动添加savepoint，那么新程序能从savepoint的地方开始读取数据，能与老程序并行存在或者直接替换</text></g></g></g></g></svg>
</div>

<hr />
<p>至此，本篇内容完成。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
如有问题，请发送邮件至leafming@foxmail.com联系我，谢谢～
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      叶子  ( ˘ ³˘)♥
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://localhost:4000/bigdata/2019/02/17/Flink%E8%BF%90%E8%A1%8C%E6%97%B6%E8%84%91%E5%9B%BE%E6%A2%B3%E7%90%86/" title="Flink分布式运行时知识梳理脑图">Flink分布式运行时知识梳理脑图</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/Flink" rel="tag"># Flink</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/bigdata/2019/02/17/Flink%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86%E8%84%91%E5%9B%BE/" rel="prev" title="Flink编程模型知识梳理脑图">
                Flink编程模型知识梳理脑图 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNTIzNi8xMTc3Mg=="></div>
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        




      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/IMG_8739.GIF"
               alt="叶子  ( ˘ ³˘)♥" />
          <p class="site-author-name" itemprop="name">叶子  ( ˘ ³˘)♥</p>
           
              <p class="site-description motion-element" itemprop="description">Yesterday you said tomorrow.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="mailto:leafming@foxmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                  E-Mail
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">叶子  ( ˘ ³˘)♥</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://jekyllrb.com">Jekyll</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  











  




  

    
      <script type="text/javascript">
        (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
        })(document, 'script');
      </script>
    

  





  


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("c82MFNFEU6p4iaz5Ik4L07e5-gzGzoHsz", "CSzcJkq7WGpn5bNMendMuKYf");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>

